---
title: "sr thesis components"
author: "Zoe Fung"
date: "8/31/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# packages
```{r}
# load required packages
library(readr)
library(ggplot2)
library(tibble)
library(janitor)
library(plyr)
library(dplyr)
library(stringr)
library(tidyr)
library(forcats)
library(ggthemes)
library(tidystats)
library(RColorBrewer)
library(kableExtra)
library(stats)
library(ggfortify)
library(wesanderson)
library(vegan)
```

# data cleaning 
## pre-fire 

### laguna mountain
```{r}
# load in raw pre-fire laguna mountain data (2020)
lm_128 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_128_2020_trees.csv") %>%
  mutate(plot_id = rep(128, length = 8))
lm_129 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_129_2020_trees.csv") %>%
  mutate(plot_id = rep(129, length = 12))
lm_130 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_130_2020_trees.csv") %>%
  mutate(plot_id = rep(130, length = 12))
lm_131 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_131_2020_trees.csv") %>%
  mutate(plot_id = rep(131, length = 7))
lm_132 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_132_2020_trees.csv") %>%
  mutate(plot_id = rep(132, length = 3))
lm_133 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_133_2020_trees.csv") %>%
  mutate(plot_id = rep(133, length = 6))
lm_134 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_134_2020_trees.csv") %>%
  mutate(plot_id = rep(134, length = 10))
lm_135 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_135_2020_trees.csv") %>%
  mutate(plot_id = rep(135, length = 6))
lm_137 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_137_2020_trees.csv") %>%
  mutate(plot_id = rep(137, length = 7))
lm_138 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_138_2020_trees.csv") %>%
  mutate(plot_id = rep(138, length = 7))
lm_139 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_139_2020_trees.csv") %>%
  mutate(plot_id = rep(139, length = 6))
lm_140 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_140_2020_trees.csv") %>%
  mutate(plot_id = rep(140, length = 7))
lm_141 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_141_2020_trees.csv") %>%
  mutate(plot_id = rep(141, length = 8))
lm_142 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_142_2020_trees.csv") %>%
  mutate(plot_id = rep(142, length = 8))
lm_143 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_143_2020_trees.csv") %>%
  mutate(plot_id = rep(143, length = 10))
lm_144 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_144_2020_trees.csv") %>%
  mutate(plot_id = rep(144, length = 6))
lm_170 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_170_2021_trees.csv") %>%
  mutate(plot_id = rep(170, length = 7))
lm_171 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_171_2021_trees.csv") %>%
  mutate(plot_id = rep(171, length = 8))
lm_172 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_172_2020_trees.csv") %>%
  mutate(plot_id = rep(172, length = 9))
lm_173 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_173_2021_trees.csv") %>%
  mutate(plot_id = rep(173, length = 15))
lm_175 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_175_2021_trees.csv") %>%
  mutate(plot_id = rep(175, length = 8))
lm_176 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_176_2021_trees.csv") %>%
  mutate(plot_id = rep(176, length = 7))
lm_177 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_177_2021_trees.csv") %>%
  mutate(plot_id = rep(177, length = 7))
lm_179 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_179_2021_trees.csv") %>%
  mutate(plot_id = rep(179, length = 6))
lm_180 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_180_2021_trees.csv") %>%
  mutate(plot_id = rep(180, length = 17))
lm_181 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_181_2021_trees.csv") %>%
  mutate(plot_id = rep(181, length = 19))
lm_195 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_195_2021_trees.csv") %>%
  mutate(plot_id = rep(195, length = 25))
lm_196 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_196_2021_trees.csv") %>%
  mutate(plot_id = rep(196, length = 8))
lm_197 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_197_2021_trees.csv") %>%
  mutate(plot_id = rep(197, length = 5))
lm_198 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_198_2021_trees.csv") %>%
  mutate(plot_id = rep(198, length = 7))
lm_199 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_199_2021_trees.csv") %>%
  mutate(plot_id = rep(199, length = 12))
lm_200 <- read.csv("data/Nicole/laguna/lagunamtnpre/LM_200_2021_trees.csv") %>%
  mutate(plot_id = rep(200, length = 11))

# combine raw pre-fire laguna data into one data frame
laguna_pre <- rbind(
  lm_128, lm_129, lm_130, lm_131, lm_132, lm_133, lm_134, lm_135, lm_137, lm_138, lm_139, lm_140, lm_141, lm_142, lm_143, lm_144, lm_170, lm_171, lm_172, lm_173, lm_175, lm_176, lm_177, lm_179, lm_180, lm_181, lm_195, lm_196, lm_197, lm_198, lm_199, lm_200) %>%
  clean_names() %>%
  select(plot_id, species, tag_no, status, dbh, ht, crwn_rto, crwn_rad, char_ht, scorch_ht, cr_sc_pct, uv1, uv2, uv3) %>%
  mutate(location = rep("Laguna", rep = 294)) %>%
  mutate(tree_area = ((pi*(dbh^2)/4)/100)) # add column w/ area measurements for each tree
```

### bluff mesa
```{r}
# read in raw pre-fire bluff mesa data (2020)
bm_24_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_24_2020_trees.csv") %>%
  mutate(plot_id = rep(24, length = 8))
bm_25_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_25_2020_trees.csv") %>%
   mutate(plot_id = rep(25, length = 4))
bm_26_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_26_2020_trees.csv") %>%
   mutate(plot_id = rep(26, length = 3))
bm_27_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_27_2020_trees.csv") %>%
   mutate(plot_id = rep(27, length = 3))
bm_33_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_33_2020_trees.csv") %>%
   mutate(plot_id = rep(33, length = 4))
bm_48_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_48_2020_trees.csv") %>%
   mutate(plot_id = rep(48, length = 6))
bm_49_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_49_2020_trees.csv") %>%
   mutate(plot_id = rep(49, length = 10))
bm_50_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_50_2020_trees.csv") %>% 
   mutate(plot_id = rep(50, length = 4))
bm_51_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_51_2020_trees.csv") %>%
   mutate(plot_id = rep(51, length = 4))
bm_52_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_52_2020_trees.csv") %>%
   mutate(plot_id = rep(52, length = 3))
bm_53_2020_trees <- read.csv("data/Nicole/bluffmesa/BM_53_2020_trees.csv") %>%
   mutate(plot_id = rep(53, length = 5))

# combine raw pre-fire bluff mesa data into one data frame
bluffmesa_pre <- rbind(
  bm_24_2020_trees, bm_25_2020_trees, bm_26_2020_trees, bm_27_2020_trees, bm_33_2020_trees, bm_48_2020_trees, bm_49_2020_trees, bm_50_2020_trees, bm_51_2020_trees, bm_52_2020_trees, bm_53_2020_trees) %>%
  clean_names() %>%
  select(plot_id, species, tag_no, status, dbh, ht, crwn_rto, crwn_rad, char_ht, scorch_ht, cr_sc_pct, uv1, uv2, uv3) %>%
  mutate(location = rep("Bluff Mesa", length = 54)) %>%
  mutate(tree_area = ((pi*(dbh^2)/4)/100)) # add column w/ area measurements for each tree
```


#### combine all pre-fire data
```{r}
# combine laguna mountain and bluff mesa data into one sheet
prefire_whole <- rbind(
  laguna_pre, bluffmesa_pre
) %>%
  mutate(category = rep("pre", length = 348))
```

### shrubs
```{r}
# laguna mountain
# load in raw pre-fire laguna mountain shrub data (2020)
lms_128 <- read.csv("data/Nicole/laguna/LM_128_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(128, length = 11))
lms_129 <- read.csv("data/Nicole/laguna/LM_129_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(129, length = 7))
lms_130 <- read.csv("data/Nicole/laguna/LM_130_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(130, length = 8))
lms_131 <- read.csv("data/Nicole/laguna/LM_131_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(131, length = 7))
lms_132 <- read.csv("data/Nicole/laguna/LM_132_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(132, length = 8))
lms_133 <- read.csv("data/Nicole/laguna/LM_133_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(133, length = 7))
lms_134 <- read.csv("data/Nicole/laguna/LM_134_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(134, length = 8))
lms_135 <- read.csv("data/Nicole/laguna/LM_135_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(135, length = 9))
lms_137 <- read.csv("data/Nicole/laguna/LM_137_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(137, length = 8))
lms_138 <- read.csv("data/Nicole/laguna/LM_138_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(138, length = 8))
lms_139 <- read.csv("data/Nicole/laguna/LM_139_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(139, length = 9))
lms_140 <- read.csv("data/Nicole/laguna/LM_140_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(140, length = 9))
lms_141 <- read.csv("data/Nicole/laguna/LM_141_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(141, length = 7))
lms_142 <- read.csv("data/Nicole/laguna/LM_142_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(142, length = 9))
lms_143 <- read.csv("data/Nicole/laguna/LM_143_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(143, length = 6))
lms_144 <- read.csv("data/Nicole/laguna/LM_144_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(144, length = 7))
lms_170 <- read.csv("data/Nicole/laguna/LM_170_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(170, length = 7))
lms_171 <- read.csv("data/Nicole/laguna/LM_171_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(171, length = 7))
lms_172 <- read.csv("data/Nicole/laguna/LM_172_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(172, length = 7))
lms_173 <- read.csv("data/Nicole/laguna/LM_173_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(173, length = 7))
lms_175 <- read.csv("data/Nicole/laguna/LM_175_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(175, length = 9))
lms_176 <- read.csv("data/Nicole/laguna/LM_176_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(176, length = 8))
lms_177 <- read.csv("data/Nicole/laguna/LM_177_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(177, length = 8))
lms_179 <- read.csv("data/Nicole/laguna/LM_179_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(179, length = 10))
lms_180 <- read.csv("data/Nicole/laguna/LM_180_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(180, length = 10))
lms_181 <- read.csv("data/Nicole/laguna/LM_181_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(181, length = 9))
lms_195 <- read.csv("data/Nicole/laguna/LM_195_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(195, length = 9))
lms_196 <- read.csv("data/Nicole/laguna/LM_196_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(196, length = 8))
lms_197 <- read.csv("data/Nicole/laguna/LM_197_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(197, length = 10))
lms_198 <- read.csv("data/Nicole/laguna/LM_198_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(198, length = 5))
lms_199 <- read.csv("data/Nicole/laguna/LM_199_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(199, length = 6))
lms_200 <- read.csv("data/Nicole/laguna/LM_200_2021_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(200, length = 8))

# combine raw pre-fire laguna shrubs data into one data frame
laguna_shrubs_pre <- rbind(
  lms_128, lms_129, lms_130, lms_131, lms_132, lms_133, lms_134, lms_135, lms_137, lms_138, lms_139, lms_140, lms_141, lms_142, lms_143, lms_144, lms_170, lms_171, lms_172, lms_173, lms_175, lms_176, lms_177, lms_179, lms_180, lms_181, lms_195, lms_196, lms_197, lms_198, lms_199, lms_200) %>%
  clean_names() %>%
  select(plot_id, species, abundance) %>%
  filter(!species=="PIJE") %>%
  filter(!species=="QUKE") %>%
  mutate(location = rep("Laguna", rep = 193))
  
# read in raw pre-fire bluff mesa data (2020) 
bms_24_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_24_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
  mutate(plot_id = rep(24, length = 6))
bms_25_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_25_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(25, length = 6))
bms_26_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_26_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(26, length = 6))
bms_27_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_27_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(27, length = 7))
bms_33_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_33_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(33, length = 7))
bms_48_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_48_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(48, length = 4))
bms_49_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_49_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(49, length = 8))
bms_50_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_50_2020_cover.csv") %>% 
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(50, length = 8))
bms_51_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_51_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(51, length = 7))
bms_52_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_52_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(52, length = 7))
bms_53_2020_cover <- read.csv("data/Nicole/bluffmesa/BM_53_2020_cover.csv") %>%
  group_by(Species) %>%
  summarise(abundance = sum(Cover)) %>%
   mutate(plot_id = rep(53, length = 5))

# combine raw pre-fire bluff mesa shrub data into one data frame
bluffmesa_shrubs_pre <- rbind(
  bms_24_2020_cover, bms_25_2020_cover, bms_26_2020_cover, bms_27_2020_cover, bms_33_2020_cover, bms_48_2020_cover, bms_49_2020_cover, bms_50_2020_cover, bms_51_2020_cover, bms_52_2020_cover, bms_53_2020_cover) %>%
  clean_names() %>%
  select(plot_id, species, abundance) %>%
  filter(!species=="PIJE") %>%
  filter(!species=="ABCO") %>%
  mutate(location = rep("Bluff Mesa", length = 50))

unique(laguna_shrubs_pre$species)
unique(bluffmesa_shrubs_pre$species)

# species IDs: 46727, 21797, 11318, 52515, 21818, 50872, 42805, 34433, 88634, 229308, 5208, 53987, 5184, 25219, 3193, 44440, 8548, 205590, 13261, 4508, 20809, 34249, 66892, 13906, 8256, 4520, 361409, 350251, 339433, 11291, 264243, 25831, 47869, 20339, 52520, 12644, 29319, 88634, 64910
```

## abundance
### laguna mountain
```{r}
# calculation for tree area measurement
laguna_pre <- laguna_pre %>%
  mutate(tree_area = ((pi*((laguna_pre$dbh/2)^2))/100))
bluffmesa_pre <- bluffmesa_pre %>%
  mutate(tree_area = ((pi*((bluffmesa_pre$dbh/2)^2))/100)) # add column with area measurements for each tree (m^2)

# since location data is organized by PLOT, find tree area per plot (subset by species)
laguna_species <- unique(laguna_pre$species) # create list of all species present in laguna fire data

laguna_pre_PIJE <- filter(laguna_pre, species == "PIJE") # create data frame w/ only PIJE sp.
laguna_pre_QUKE <- filter(laguna_pre, species == "QUKE") # create data frame w/ only QUKE sp.

#### PIJE

laguna_pre_PIJE_plots <- unique(laguna_pre_PIJE$plot_id) # print each plot ID where PIJE is present

# create a data frame for each plot 
## NOTE: each plot is an 11.3m radius circular plot
laguna_pre_PIJE_128 <- filter(laguna_pre_PIJE, plot_id == "128")
laguna_pre_PIJE_129 <- filter(laguna_pre_PIJE, plot_id == "129")
laguna_pre_PIJE_130 <- filter(laguna_pre_PIJE, plot_id == "130")
laguna_pre_PIJE_131 <- filter(laguna_pre_PIJE, plot_id == "131")
laguna_pre_PIJE_132 <- filter(laguna_pre_PIJE, plot_id == "132")
laguna_pre_PIJE_133 <- filter(laguna_pre_PIJE, plot_id == "133")
laguna_pre_PIJE_134 <- filter(laguna_pre_PIJE, plot_id == "134")
laguna_pre_PIJE_135 <- filter(laguna_pre_PIJE, plot_id == "135")
laguna_pre_PIJE_137 <- filter(laguna_pre_PIJE, plot_id == "137")
laguna_pre_PIJE_138 <- filter(laguna_pre_PIJE, plot_id == "138")
laguna_pre_PIJE_139 <- filter(laguna_pre_PIJE, plot_id == "139")
laguna_pre_PIJE_140 <- filter(laguna_pre_PIJE, plot_id == "140")
laguna_pre_PIJE_141 <- filter(laguna_pre_PIJE, plot_id == "141")
laguna_pre_PIJE_142 <- filter(laguna_pre_PIJE, plot_id == "142")
laguna_pre_PIJE_143 <- filter(laguna_pre_PIJE, plot_id == "143")
laguna_pre_PIJE_144 <- filter(laguna_pre_PIJE, plot_id == "144")
laguna_pre_PIJE_170 <- filter(laguna_pre_PIJE, plot_id == "170")
laguna_pre_PIJE_171 <- filter(laguna_pre_PIJE, plot_id == "171")
laguna_pre_PIJE_172 <- filter(laguna_pre_PIJE, plot_id == "172")
laguna_pre_PIJE_173 <- filter(laguna_pre_PIJE, plot_id == "173")
laguna_pre_PIJE_175 <- filter(laguna_pre_PIJE, plot_id == "175")
laguna_pre_PIJE_176 <- filter(laguna_pre_PIJE, plot_id == "176")
laguna_pre_PIJE_177 <- filter(laguna_pre_PIJE, plot_id == "177")
laguna_pre_PIJE_179 <- filter(laguna_pre_PIJE, plot_id == "179")
laguna_pre_PIJE_180 <- filter(laguna_pre_PIJE, plot_id == "180")
laguna_pre_PIJE_181 <- filter(laguna_pre_PIJE, plot_id == "181")
laguna_pre_PIJE_195 <- filter(laguna_pre_PIJE, plot_id == "195")
laguna_pre_PIJE_197 <- filter(laguna_pre_PIJE, plot_id == "197")
laguna_pre_PIJE_198 <- filter(laguna_pre_PIJE, plot_id == "198")
laguna_pre_PIJE_199 <- filter(laguna_pre_PIJE, plot_id == "199")
laguna_pre_PIJE_200 <- filter(laguna_pre_PIJE, plot_id == "200")

# calculate plot area
plot_area <- pi*(11.3^2)
## plot area = 401.15m^2

# create vectors of the sum of each species' area per plot
l_p_128 <- sum(laguna_pre_PIJE_128$tree_area)
l_p_129 <- sum(laguna_pre_PIJE_129$tree_area)
l_p_130 <- sum(laguna_pre_PIJE_130$tree_area)
l_p_131 <- sum(laguna_pre_PIJE_131$tree_area)
l_p_132 <- sum(laguna_pre_PIJE_132$tree_area)
l_p_133 <- sum(laguna_pre_PIJE_133$tree_area)
l_p_134 <- sum(laguna_pre_PIJE_134$tree_area)
l_p_135 <- sum(laguna_pre_PIJE_135$tree_area)
l_p_137 <- sum(laguna_pre_PIJE_137$tree_area)
l_p_138 <- sum(laguna_pre_PIJE_138$tree_area)
l_p_139 <- sum(laguna_pre_PIJE_139$tree_area)
l_p_140 <- sum(laguna_pre_PIJE_140$tree_area)
l_p_141 <- sum(laguna_pre_PIJE_141$tree_area)
l_p_142 <- sum(laguna_pre_PIJE_142$tree_area)
l_p_143 <- sum(laguna_pre_PIJE_143$tree_area)
l_p_144 <- sum(laguna_pre_PIJE_144$tree_area)
l_p_170 <- sum(laguna_pre_PIJE_170$tree_area)
l_p_171 <- sum(laguna_pre_PIJE_171$tree_area)
l_p_172 <- sum(laguna_pre_PIJE_172$tree_area)
l_p_173 <- sum(laguna_pre_PIJE_173$tree_area)
l_p_175 <- sum(laguna_pre_PIJE_175$tree_area)
l_p_176 <- sum(laguna_pre_PIJE_176$tree_area)
l_p_177 <- sum(laguna_pre_PIJE_177$tree_area)
l_p_179 <- sum(laguna_pre_PIJE_179$tree_area)
l_p_180 <- sum(laguna_pre_PIJE_180$tree_area)
l_p_181 <- sum(laguna_pre_PIJE_181$tree_area)
l_p_195 <- sum(laguna_pre_PIJE_195$tree_area)
l_p_197 <- sum(laguna_pre_PIJE_197$tree_area)
l_p_198 <- sum(laguna_pre_PIJE_198$tree_area)
l_p_199 <- sum(laguna_pre_PIJE_199$tree_area)
l_p_200 <- sum(laguna_pre_PIJE_200$tree_area)

# create vectors of average height of each species per plot
h_128 <- mean(laguna_pre_PIJE_128$ht)
h_129 <- mean(laguna_pre_PIJE_129$ht)
h_130 <- mean(laguna_pre_PIJE_130$ht)
h_131 <- mean(laguna_pre_PIJE_131$ht)
h_132 <- mean(laguna_pre_PIJE_132$ht)
h_133 <- mean(laguna_pre_PIJE_133$ht)
h_134 <- mean(laguna_pre_PIJE_134$ht)
h_135 <- mean(laguna_pre_PIJE_135$ht)
h_137 <- mean(laguna_pre_PIJE_137$ht)
h_138 <- mean(laguna_pre_PIJE_138$ht)
h_139 <- mean(laguna_pre_PIJE_139$ht)
h_140 <- mean(laguna_pre_PIJE_140$ht)
h_141 <- mean(laguna_pre_PIJE_141$ht)
h_142 <- mean(laguna_pre_PIJE_142$ht)
h_143 <- mean(laguna_pre_PIJE_143$ht)
h_144 <- mean(laguna_pre_PIJE_144$ht)
h_170 <- mean(laguna_pre_PIJE_170$ht)
h_171 <- mean(laguna_pre_PIJE_171$ht)
h_172 <- mean(laguna_pre_PIJE_172$ht)
h_173 <- mean(laguna_pre_PIJE_173$ht)
h_175 <- mean(laguna_pre_PIJE_175$ht)
h_176 <- mean(laguna_pre_PIJE_176$ht)
h_177 <- mean(laguna_pre_PIJE_177$ht)
h_179 <- mean(laguna_pre_PIJE_179$ht)
h_180 <- mean(laguna_pre_PIJE_180$ht)
h_181 <- mean(laguna_pre_PIJE_181$ht)
h_195 <- mean(laguna_pre_PIJE_195$ht)
h_197 <- mean(laguna_pre_PIJE_197$ht)
h_198 <- mean(laguna_pre_PIJE_198$ht)
h_199 <- mean(laguna_pre_PIJE_199$ht)
h_200 <- mean(laguna_pre_PIJE_200$ht)

# create data frame: project, year, plot_id, & abundance for PIJE
laguna_pre_PIJE_clean <- data.frame(
  project = rep("Laguna Mtn.", times = length(laguna_pre_PIJE_plots)), 
  species = rep("PIJE", times = length(laguna_pre_PIJE_plots)),
  plot_id = c(laguna_pre_PIJE_plots),
  abundance = c(l_p_128/plot_area, l_p_129/plot_area, l_p_130/plot_area, l_p_131/plot_area, l_p_132/plot_area, l_p_133/plot_area, l_p_134/plot_area, l_p_135/plot_area, l_p_137/plot_area, l_p_138/plot_area, l_p_139/plot_area, l_p_140/plot_area, l_p_141/plot_area, l_p_142/plot_area, l_p_143/plot_area, l_p_144/plot_area, l_p_170/plot_area, l_p_171/plot_area, l_p_172/plot_area, l_p_173/plot_area, l_p_175/plot_area, l_p_176/plot_area, l_p_177/plot_area, l_p_179/plot_area, l_p_180/plot_area, l_p_181/plot_area, l_p_195/plot_area, l_p_197/plot_area, l_p_198/plot_area, l_p_199/plot_area, l_p_200/plot_area),
  avg_ht = c(h_128, h_129, h_130, h_131, h_132, h_133, h_134, h_135, h_137, h_138, h_139, h_140, h_141, h_142, h_143, h_144, h_170, h_171, h_172, h_173, h_175, h_176, h_177, h_179, h_180, h_181, h_195, h_197, h_198, h_199, h_200),
  easting = c(552604, 552907, 552703, 552825, 552934, 552930, 552944, 553054, 552809, 552825, 552701, 552968, 552953, 552964, 552871, 552990, 553555, 553650, 553694, 553741, 553748, 553722, 553810, 553733, 553796, 553745, 553844, 553803, 553697, 553634, 553638),
  northing = c(3635674, 3635674, 3635674, 3635674, 3635625, 3635689, 3635441, 3635389, 3635340, 3635401, 3635401, 3635072, 3634891, 3636126, 3635065, 3635000, 3635917, 3635822, 3636045, 3636012, 3635916, 3635733, 3635775, 3635619, 3635629, 3635589, 3635701, 3635729, 3635950, 3635975, 3635910)
)

#### QUKE

laguna_pre_QUKE_plots <- unique(laguna_pre_QUKE$plot_id) # print each plot ID where QUKE is present

# create a data frame for each plot 
## NOTE: each plot is an 11.3m radius circular plot
laguna_pre_QUKE_128 <- filter(laguna_pre_QUKE, plot_id == "128")
laguna_pre_QUKE_129 <- filter(laguna_pre_QUKE, plot_id == "129")
laguna_pre_QUKE_130 <- filter(laguna_pre_QUKE, plot_id == "130")
laguna_pre_QUKE_131 <- filter(laguna_pre_QUKE, plot_id == "131")
laguna_pre_QUKE_133 <- filter(laguna_pre_QUKE, plot_id == "133")
laguna_pre_QUKE_134 <- filter(laguna_pre_QUKE, plot_id == "134")
laguna_pre_QUKE_135 <- filter(laguna_pre_QUKE, plot_id == "135")
laguna_pre_QUKE_137 <- filter(laguna_pre_QUKE, plot_id == "137")
laguna_pre_QUKE_138 <- filter(laguna_pre_QUKE, plot_id == "138")
laguna_pre_QUKE_139 <- filter(laguna_pre_QUKE, plot_id == "139")
laguna_pre_QUKE_140 <- filter(laguna_pre_QUKE, plot_id == "140")
laguna_pre_QUKE_141 <- filter(laguna_pre_QUKE, plot_id == "141")
laguna_pre_QUKE_142 <- filter(laguna_pre_QUKE, plot_id == "142")
laguna_pre_QUKE_143 <- filter(laguna_pre_QUKE, plot_id == "143")
laguna_pre_QUKE_144 <- filter(laguna_pre_QUKE, plot_id == "144")
laguna_pre_QUKE_170 <- filter(laguna_pre_QUKE, plot_id == "170")
laguna_pre_QUKE_171 <- filter(laguna_pre_QUKE, plot_id == "171")
laguna_pre_QUKE_172 <- filter(laguna_pre_QUKE, plot_id == "172")
laguna_pre_QUKE_173 <- filter(laguna_pre_QUKE, plot_id == "173")
laguna_pre_QUKE_175 <- filter(laguna_pre_QUKE, plot_id == "175")
laguna_pre_QUKE_176 <- filter(laguna_pre_QUKE, plot_id == "176")
laguna_pre_QUKE_177 <- filter(laguna_pre_QUKE, plot_id == "177")
laguna_pre_QUKE_179 <- filter(laguna_pre_QUKE, plot_id == "179")
laguna_pre_QUKE_180 <- filter(laguna_pre_QUKE, plot_id == "180")
laguna_pre_QUKE_181 <- filter(laguna_pre_QUKE, plot_id == "181")
laguna_pre_QUKE_195 <- filter(laguna_pre_QUKE, plot_id == "195")
laguna_pre_QUKE_197 <- filter(laguna_pre_QUKE, plot_id == "197")
laguna_pre_QUKE_198 <- filter(laguna_pre_QUKE, plot_id == "198")
laguna_pre_QUKE_199 <- filter(laguna_pre_QUKE, plot_id == "199")
laguna_pre_QUKE_200 <- filter(laguna_pre_QUKE, plot_id == "200")

# calculate plot area
plot_area <- pi*(11.35^2)
## plot area = 401.15m^2

# create vectors of the sum of each species' area per plot
l_q_128 <- sum(laguna_pre_QUKE_128$tree_area)
l_q_129 <- sum(laguna_pre_QUKE_129$tree_area)
l_q_130 <- sum(laguna_pre_QUKE_130$tree_area)
l_q_131 <- sum(laguna_pre_QUKE_131$tree_area)
l_q_133 <- sum(laguna_pre_QUKE_133$tree_area)
l_q_134 <- sum(laguna_pre_QUKE_134$tree_area)
l_q_135 <- sum(laguna_pre_QUKE_135$tree_area)
l_q_137 <- sum(laguna_pre_QUKE_137$tree_area)
l_q_138 <- sum(laguna_pre_QUKE_138$tree_area)
l_q_139 <- sum(laguna_pre_QUKE_139$tree_area)
l_q_140 <- sum(laguna_pre_QUKE_140$tree_area)
l_q_141 <- sum(laguna_pre_QUKE_141$tree_area)
l_q_142 <- sum(laguna_pre_QUKE_142$tree_area)
l_q_143 <- sum(laguna_pre_QUKE_143$tree_area)
l_q_144 <- sum(laguna_pre_QUKE_144$tree_area)
l_q_170 <- sum(laguna_pre_QUKE_170$tree_area)
l_q_171 <- sum(laguna_pre_QUKE_171$tree_area)
l_q_172 <- sum(laguna_pre_QUKE_172$tree_area)
l_q_173 <- sum(laguna_pre_QUKE_173$tree_area)
l_q_175 <- sum(laguna_pre_QUKE_175$tree_area)
l_q_176 <- sum(laguna_pre_QUKE_176$tree_area)
l_q_177 <- sum(laguna_pre_QUKE_177$tree_area)
l_q_179 <- sum(laguna_pre_QUKE_179$tree_area)
l_q_180 <- sum(laguna_pre_QUKE_180$tree_area)
l_q_181 <- sum(laguna_pre_QUKE_181$tree_area)
l_q_195 <- sum(laguna_pre_QUKE_195$tree_area)
l_q_197 <- sum(laguna_pre_QUKE_197$tree_area)
l_q_198 <- sum(laguna_pre_QUKE_198$tree_area)
l_q_199 <- sum(laguna_pre_QUKE_199$tree_area)
l_q_200 <- sum(laguna_pre_QUKE_200$tree_area)

# create vectors of the average height of each species per plot
h_q_128 <- mean(laguna_pre_QUKE_128$ht)
h_q_129 <- mean(laguna_pre_QUKE_129$ht)
h_q_130 <- mean(laguna_pre_QUKE_130$ht)
h_q_131 <- mean(laguna_pre_QUKE_131$ht)
h_q_133 <- mean(laguna_pre_QUKE_133$ht)
h_q_134 <- mean(laguna_pre_QUKE_134$ht)
h_q_135 <- mean(laguna_pre_QUKE_135$ht)
h_q_137 <- mean(laguna_pre_QUKE_137$ht)
h_q_138 <- mean(laguna_pre_QUKE_138$ht)
h_q_139 <- mean(laguna_pre_QUKE_139$ht)
h_q_140 <- mean(laguna_pre_QUKE_140$ht)
h_q_141 <- mean(laguna_pre_QUKE_141$ht)
h_q_142 <- mean(laguna_pre_QUKE_142$ht)
h_q_143 <- mean(laguna_pre_QUKE_143$ht)
h_q_144 <- mean(laguna_pre_QUKE_144$ht)
h_q_170 <- mean(laguna_pre_QUKE_170$ht)
h_q_171 <- mean(laguna_pre_QUKE_171$ht)
h_q_172 <- mean(laguna_pre_QUKE_172$ht)
h_q_173 <- mean(laguna_pre_QUKE_173$ht)
h_q_175 <- mean(laguna_pre_QUKE_175$ht)
h_q_176 <- mean(laguna_pre_QUKE_176$ht)
h_q_177 <- mean(laguna_pre_QUKE_177$ht)
h_q_179 <- mean(laguna_pre_QUKE_179$ht)
h_q_180 <- mean(laguna_pre_QUKE_180$ht)
h_q_181 <- mean(laguna_pre_QUKE_181$ht)
h_q_195 <- mean(laguna_pre_QUKE_195$ht)
h_q_197 <- mean(laguna_pre_QUKE_197$ht)
h_q_198 <- mean(laguna_pre_QUKE_198$ht)
h_q_199 <- mean(laguna_pre_QUKE_199$ht)
h_q_200 <- mean(laguna_pre_QUKE_200$ht)

# create data frame: project, year, plot_id, & abundance for QUKE
laguna_pre_QUKE_clean <- data.frame(
  project = rep("Laguna Mtn.", times = length(laguna_pre_QUKE_plots)), 
  species = rep("QUKE", times = length(laguna_pre_QUKE_plots)),
  plot_id = c(laguna_pre_QUKE_plots),
  abundance = c(l_q_128/plot_area, l_q_129/plot_area, l_q_130/plot_area, l_q_131/plot_area, l_q_133/plot_area, l_q_134/plot_area, l_q_135/plot_area, l_q_137/plot_area, l_q_138/plot_area, l_q_139/plot_area, l_q_140/plot_area, l_q_141/plot_area, l_q_142/plot_area, l_q_143/plot_area, l_q_144/plot_area, l_q_170/plot_area, l_q_171/plot_area, l_q_172/plot_area, l_q_173/plot_area, l_q_175/plot_area, l_q_176/plot_area, l_q_177/plot_area, l_q_179/plot_area, l_q_180/plot_area, l_q_181/plot_area, l_q_195/plot_area, l_q_197/plot_area, l_q_198/plot_area, l_q_199/plot_area, l_q_200/plot_area),
  avg_ht = c(h_q_128, h_q_129, h_q_130, h_q_131, h_q_133, h_q_134, h_q_135, h_q_137, h_q_138, h_q_139, h_q_140, h_q_141, h_q_142, h_q_143, h_q_144, h_q_170, h_q_171, h_q_172, h_q_173, h_q_175, h_q_176, h_q_177, h_q_179, h_q_180, h_q_181, h_q_195, h_q_197, h_q_198, h_q_199, h_q_200),
  easting = c(552604, 552907, 552703, 552825, 552930, 552944, 553054, 552809, 552825, 552701, 552953, 552964, 552871, 552990, 553555, 553650, 553694, 553741, 553748, 553722, 553810, 553733, 553796, 553745, 553844, 553738, 553803, 553697, 553634, 553638),
  northing = c(3635674, 3635518, 3635561, 3635690, 3635689, 3635441, 3635389, 3635340, 3635401, 3635401, 3634891, 3636126, 3635065, 3635000, 3635917, 3635822, 3636045, 3636012, 3635916, 3635733, 3635775, 3635619, 3635629, 3635589, 3635701, 3635675, 3635729, 3635950, 3635975, 3635910)
)

l_abundance <- rbind(laguna_pre_PIJE_clean, laguna_pre_QUKE_clean)
```

### bluff mesa
```{r}
# repeat for bluff mesa
unique(bluffmesa_pre$species) # identify species present in bluff mesa fire data

bluffmesa_pre_ABCO <- filter(bluffmesa_pre, species == "ABCO") # create data frame w/ only ABCO sp.
bluffmesa_pre_PIJE <- filter(bluffmesa_pre, species == "PIJE") # create data frame w/ only PIJE sp.

#### ABCO

unique(bluffmesa_pre_ABCO$plot_id) # print each plot ID where ABCO is present

# create a data frame for each plot 
## NOTE: each plot is an 11.3m radius circular plot
bluffmesa_pre_ABCO_24 <- filter(bluffmesa_pre_ABCO, plot_id == "24")
bluffmesa_pre_ABCO_26 <- filter(bluffmesa_pre_ABCO, plot_id == "26")
bluffmesa_pre_ABCO_33 <- filter(bluffmesa_pre_ABCO, plot_id == "33")
bluffmesa_pre_ABCO_48 <- filter(bluffmesa_pre_ABCO, plot_id == "48")
bluffmesa_pre_ABCO_49 <- filter(bluffmesa_pre_ABCO, plot_id == "49")
bluffmesa_pre_ABCO_52 <- filter(bluffmesa_pre_ABCO, plot_id == "52")

# calculate plot area
plot_area <- pi*(11.35^2)
## plot area = 401.15m^2

# create data frame: project, year, plot_id, & abundance for ABCO
bluffmesa_pre_ABCO_clean <- data.frame(
  project = rep("Bluff Mesa", times = length(unique(bluffmesa_pre_ABCO$plot_id))), 
  species = rep("ABCO", times = length(unique(bluffmesa_pre_ABCO$plot_id))),
  plot_id = c(unique(bluffmesa_pre_ABCO$plot_id)),
  abundance = c(sum(bluffmesa_pre_ABCO_24$tree_area)/plot_area, sum(bluffmesa_pre_ABCO_26$tree_area)/plot_area, sum(bluffmesa_pre_ABCO_33$tree_area)/plot_area, sum(bluffmesa_pre_ABCO_48$tree_area)/plot_area, sum(bluffmesa_pre_ABCO_49$tree_area)/plot_area, sum(bluffmesa_pre_ABCO_52$tree_area)/plot_area),
  avg_ht = c(mean(bluffmesa_pre_ABCO_24$ht), mean(bluffmesa_pre_ABCO_26$ht), mean(bluffmesa_pre_ABCO_33$ht), mean(bluffmesa_pre_ABCO_48$ht), mean(bluffmesa_pre_ABCO_49$ht), mean(bluffmesa_pre_ABCO_52$ht)),
  easting = c(502045, 502155, 502518, 502663, 502600, 503370),
  northing = c(3786845, 3786746, 3786610, 3787038, 3787201, 3786975)
) # note --> no abundance data for plot 26 because there is no dbh data

#### PIJE

unique(bluffmesa_pre_PIJE$plot_id) # print each plot ID where PIJE is present

# create a data frame for each plot 
## NOTE: each plot is an 11.3m radius circular plot
bluffmesa_pre_PIJE_24 <- filter(bluffmesa_pre_PIJE, plot_id == "24")
bluffmesa_pre_PIJE_25 <- filter(bluffmesa_pre_PIJE, plot_id == "25")
bluffmesa_pre_PIJE_26 <- filter(bluffmesa_pre_PIJE, plot_id == "26")
bluffmesa_pre_PIJE_27 <- filter(bluffmesa_pre_PIJE, plot_id == "27")
bluffmesa_pre_PIJE_33 <- filter(bluffmesa_pre_PIJE, plot_id == "33")
bluffmesa_pre_PIJE_49 <- filter(bluffmesa_pre_PIJE, plot_id == "49")
bluffmesa_pre_PIJE_50 <- filter(bluffmesa_pre_PIJE, plot_id == "50")
bluffmesa_pre_PIJE_51 <- filter(bluffmesa_pre_PIJE, plot_id == "51")
bluffmesa_pre_PIJE_52 <- filter(bluffmesa_pre_PIJE, plot_id == "52")
bluffmesa_pre_PIJE_53 <- filter(bluffmesa_pre_PIJE, plot_id == "53")

# create data frame: project, year, plot_id, & abundance for PIJE
bluffmesa_pre_PIJE_clean <- data.frame(
  project = rep("Bluff Mesa", times = length(unique(bluffmesa_pre_PIJE$plot_id))), 
  species = rep("PIJE", times = length(unique(bluffmesa_pre_PIJE$plot_id))),
  plot_id = c(unique(bluffmesa_pre_PIJE$plot_id)),
  abundance = c(sum(bluffmesa_pre_PIJE_24$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_25$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_26$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_27$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_33$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_49$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_50$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_51$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_52$tree_area)/plot_area, sum(bluffmesa_pre_PIJE_53$tree_area)/plot_area),
  avg_ht = c(mean(bluffmesa_pre_PIJE_24$ht), mean(bluffmesa_pre_PIJE_25$ht), mean(bluffmesa_pre_PIJE_26$ht), mean(bluffmesa_pre_PIJE_27$ht), mean(bluffmesa_pre_PIJE_33$ht), mean(bluffmesa_pre_PIJE_49$ht), mean(bluffmesa_pre_PIJE_50$ht), mean(bluffmesa_pre_PIJE_51$ht), mean(bluffmesa_pre_PIJE_52$ht), mean(bluffmesa_pre_PIJE_53$ht)),
  easting = c(502045, 502018, 502155, 502360, 502518, 502600, 502811, 503248, 503370, 502980),
  northing = c(3786845, 3786660, 3786746, 3786721, 3786610, 3787201, 3787146, 3787101, 3786975, 3787237)
)

# combine all pre-fire data from bluff mesa plots
bm_abundance <- rbind(bluffmesa_pre_PIJE_clean, bluffmesa_pre_ABCO_clean)
```
#### combine all abundance data
```{r}
# load in x & y coords
# coord <- read_csv("data/Nicole/zoe_transect_coordinates.csv") %>%
#   clean_names()
# 
# # combine abundance across all three plots
# abundance_whole <- rbind(l_abundance, bm_abundance, tf_abundance) %>%
#   mutate(x_long = coord$x_long) %>%
#   mutate(y_lat = coord$y_lat)
#   # note: BM 26 ABCO = NA b/c no dbh data recorded
# 
# # export to csv
# write.csv(abundance_whole, "data/Nicole/abundance_whole.csv", row.names=FALSE)
```

## fuels data
```{r}
# load in raw pre-fire fuels data
LMF_1 <- read.csv("data/Nicole/fuels/LM_2020_fuels_128-133.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMF_2 <- read.csv("data/Nicole/fuels/LM_2020_fuels_134-139.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMF_3 <- read.csv("data/Nicole/fuels/LM_2020_fuels_140-145.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMF_4 <- read.csv("data/Nicole/fuels/LM_2021_fuels_170-200.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 16))
BMF_1 <- read.csv("data/Nicole/fuels/BM_2020_fuels_24-33.csv") %>%
  mutate(location = rep("Bluff Mesa", length = 5))
BMF_2 <- read.csv("data/Nicole/fuels/BM_2020_fuels_48-53.csv") %>%
  mutate(location = rep("Bluff Mesa", length = 6))

# load in raw post-fire fuels data
LMFP_1 <- read.csv("data/Nicole/fuels/LM_2021_fuels_128-133.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMFP_2 <- read.csv("data/Nicole/fuels/LM_2021_fuels_134-139.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMFP_3 <- read.csv("data/Nicole/fuels/LM_2021_fuels_140-145.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 6))
LMFP_4 <- read.csv("data/Nicole/fuels/LM_2022_fuels_170-200.csv") %>%
  mutate(location = rep("Laguna Mountain", length = 16))
BMFP_1 <- read.csv("data/Nicole/fuels/BM_2020_2_fuels_24-33.csv") %>%
  mutate(location = rep("Bluff Mesa", length = 5))
BMFP_2 <- read.csv("data/Nicole/fuels/BM_2021_fuels_48-53.csv") %>%
  mutate(location = rep("Bluff Mesa", length = 6))

# combine all raw pre-fire fuels data
fuels_whole <- rbind(
  LMF_1, LMF_2, LMF_3, LMF_4, BMF_1, BMF_2
) %>%
  clean_names() %>%
  select(macroplot, mon_status, one_hr, ten_hr, hun_hr, fine_wood, total_wood, duff, litter, total_all, duff_dep, litt_dep, tot_dep, fuel_bed_dep, location)

# combine all raw post-fire fuels data
fuels_post <- rbind(
  LMFP_1, LMFP_2, LMFP_3, LMFP_4, BMFP_1, BMFP_2) %>%
  clean_names() %>%
  select(macroplot, mon_status, one_hr, ten_hr, hun_hr, fine_wood, total_wood, duff, litter, total_all, duff_dep, litt_dep, tot_dep, fuel_bed_dep, location)

# create data frame for consumption
one_hr_diff <- fuels_whole$one_hr-fuels_post$one_hr
ten_hr_diff <- fuels_whole$ten_hr-fuels_post$ten_hr
hun_hr_diff <- fuels_whole$hun_hr-fuels_post$hun_hr
duff_diff <- fuels_whole$duff-fuels_post$duff
litter_diff <- fuels_whole$litter-fuels_post$litter
duff_dep_diff <- fuels_whole$duff_dep-fuels_post$duff_dep
litter_dep_diff <- fuels_whole$litt_dep-fuels_post$litt_dep

consumption <- data.frame(one_hr_diff, ten_hr_diff, hun_hr_diff, duff_diff, litter_diff, duff_dep_diff, litter_dep_diff) %>%
  mutate(location = fuels_post$location) %>%
  mutate(plot_id = fuels_post$macroplot) %>%
  slice(-c(9, 18)) %>%
  mutate(duff_litter_diff = duff_diff+litter_diff) %>%
  mutate(dep_diff = duff_dep_diff+litter_dep_diff)

# export as csv
write.csv(fuels_whole, "data/Nicole/fuels_whole.csv", row.names=FALSE)
```

## post-fire data
### laguna mountain post-fire
```{r}
# load in raw post-fire laguna mountain data (2021 & 2022)
lm_128_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_128_2021_trees.csv") %>%
  mutate(plot_id = rep(128, length = 8))
lm_129_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_129_2021_trees.csv") %>%
  mutate(plot_id = rep(129, length = 12))
lm_130_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_130_2021_trees.csv") %>%
  mutate(plot_id = rep(130, length = 12))
lm_131_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_131_2021_trees.csv") %>%
  mutate(plot_id = rep(131, length = 7))
lm_132_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_132_2021_trees.csv") %>%
  mutate(plot_id = rep(132, length = 3))
lm_133_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_133_2021_trees.csv") %>%
  mutate(plot_id = rep(133, length = 6))
lm_134_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_134_2021_trees.csv") %>%
  mutate(plot_id = rep(134, length = 10))
lm_135_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_135_2021_trees.csv") %>%
  mutate(plot_id = rep(135, length = 6))
lm_137_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_137_2021_trees.csv") %>%
  mutate(plot_id = rep(137, length = 7))
lm_138_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_138_2021_trees.csv") %>%
  mutate(plot_id = rep(138, length = 7))
lm_139_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_139_2021_trees.csv") %>%
  mutate(plot_id = rep(139, length = 6))
lm_140_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_140_2021_trees.csv") %>%
  mutate(plot_id = rep(140, length = 7))
lm_141_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_141_2021_trees.csv") %>%
  mutate(plot_id = rep(141, length = 8))
lm_142_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_142_2021_trees.csv") %>%
  mutate(plot_id = rep(142, length = 8))
lm_143_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_143_2021_trees.csv") %>%
  mutate(plot_id = rep(143, length = 10))
lm_144_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_144_2021_trees.csv") %>%
  mutate(plot_id = rep(144, length = 6))
lm_145_2021_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_145_2021_trees.csv") %>%
  mutate(plot_id = rep(145, length = 12))
lm_170_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_170_2022_trees.csv") %>%
  mutate(plot_id = rep(170, length = 7))
lm_171_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_171_2022_trees.csv") %>%
  mutate(plot_id = rep(171, length = 8))
lm_172_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_172_2022_trees.csv") %>%
  mutate(plot_id = rep(172, length = 9))
lm_173_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_173_2022_trees.csv") %>%
  mutate(plot_id = rep(173, length = 15))
lm_175_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_175_2022_trees.csv") %>%
  mutate(plot_id = rep(175, length = 8))
lm_176_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_176_2022_trees.csv") %>%
  mutate(plot_id = rep(176, length = 7))
lm_177_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_177_2022_trees.csv") %>%
  mutate(plot_id = rep(177, length = 7))
lm_179_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_179_2022_trees.csv") %>%
  mutate(plot_id = rep(179, length = 6))
lm_180_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_180_2022_trees.csv") %>%
  mutate(plot_id = rep(180, length = 17))
lm_181_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_181_2022_trees.csv") %>%
  mutate(plot_id = rep(181, length = 19))
lm_195_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_195_2022_trees.csv") %>%
  mutate(plot_id = rep(195, length = 25))
lm_196_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_196_2022_trees.csv") %>%
  mutate(plot_id = rep(196, length = 8))
lm_197_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_197_2022_trees.csv") %>%
  mutate(plot_id = rep(197, length = 5))
lm_198_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_198_2022_trees.csv") %>%
  mutate(plot_id = rep(198, length = 7))
lm_199_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_199_2022_trees.csv") %>%
  mutate(plot_id = rep(199, length = 12))
lm_200_2022_trees <- read.csv("data/Nicole/laguna/lagunamtn-post/LM_200_2022_trees.csv") %>%
  mutate(plot_id = rep(200, length = 11))

laguna_post <- rbind(
  lm_128_2021_trees, lm_129_2021_trees, lm_130_2021_trees, lm_132_2021_trees, lm_133_2021_trees, lm_134_2021_trees, lm_135_2021_trees, lm_137_2021_trees, lm_138_2021_trees, lm_139_2021_trees, lm_140_2021_trees, lm_141_2021_trees, lm_142_2021_trees, lm_143_2021_trees, lm_144_2021_trees, lm_145_2021_trees, lm_170_2022_trees, lm_171_2022_trees, lm_172_2022_trees, lm_173_2022_trees, lm_175_2022_trees, lm_176_2022_trees, lm_177_2022_trees, lm_179_2022_trees, lm_180_2022_trees, lm_181_2022_trees, lm_195_2022_trees, lm_196_2022_trees, lm_197_2022_trees, lm_198_2022_trees, lm_199_2022_trees, lm_200_2022_trees
) %>%
  clean_names() %>%
  mutate(location = rep("Laguna Mountain", length = 299))
laguna_post <- laguna_post %>%
  mutate(tree_area = ((pi*(laguna_post$dbh^2)/4)/100)) %>%
  select(location, plot_id, tag_no, status, dbh, ht, crwn_rto, crwn_rad, char_ht, scorch_ht, cr_sc_pct, uv1, uv2, uv3, species, tree_area)
```

### bluff mesa post-fire
```{r}
# load in raw post-fire bluff mesa data (2021)
bm_24_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_24_2021_trees.csv") %>%
  mutate(plot_id = rep(24, length = 8))
bm_25_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_25_2021_trees.csv") %>%
  mutate(plot_id = rep(25, length = 4))
bm_26_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_26_2021_trees.csv") %>%
  mutate(plot_id = rep(26, length = 3))
bm_27_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_27_2021_trees.csv") %>%
  mutate(plot_id = rep(27, length = 3))
bm_33_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_33_2021_trees.csv") %>%
  mutate(plot_id = rep(33, length = 4))
bm_48_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_48_2021_trees.csv") %>%
  mutate(plot_id = rep(48, length = 6))
bm_49_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_49_2021_trees.csv") %>%
  mutate(plot_id = rep(49, length = 10))
bm_50_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_50_2021_trees.csv") %>%
  mutate(plot_id = rep(50, length = 4))
bm_51_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_51_2021_trees.csv") %>%
  mutate(plot_id = rep(51, length = 4))
bm_52_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_52_2021_trees.csv") %>%
  mutate(plot_id = rep(52, length = 3))
bm_53_2021_trees <- read.csv("data/Nicole/bluffmesa/BM_53_2021_trees.csv") %>%
  mutate(plot_id = rep(53, length = 5))

# combine raw pre-fire bluff mesa data into one data frame
bluffmesa_post <- rbind(
  bm_24_2021_trees, bm_25_2021_trees, bm_26_2021_trees, bm_27_2021_trees, bm_33_2021_trees, bm_48_2021_trees, bm_49_2021_trees, bm_50_2021_trees, bm_51_2021_trees, bm_52_2021_trees, bm_53_2021_trees) %>%
  clean_names() %>%
  mutate(location = rep("Bluff Mesa", length = 54)) 

bluffmesa_post <- bluffmesa_post %>%
  mutate(tree_area = ((pi*(bluffmesa_post$dbh^2)/4)/100)) %>%
  select(location, plot_id, tag_no, status, dbh, ht, crwn_rto, crwn_rad, char_ht, scorch_ht, cr_sc_pct, uv1, uv2, uv3, species, tree_area)

# create 1 data frame for all post-fire data
postfire_whole <- rbind(
  laguna_post, bluffmesa_post
) %>%
  mutate(category = rep("post", length = 353)) %>%
  select(-c(uv1, uv2, uv3, tag_no, status, dbh, ht, crwn_rto, tree_area, crwn_rad)) %>%
  mutate_all(~replace_na(.,0))
```

## glopnet setup
```{r}
# read in glopnet data + clean it up
glopnet <- read_csv("data/Traits/Glopnet_database.csv") %>%
  slice_tail(n = 2548) 
  
# set column names
colnames(glopnet) <- c("code", "dataset", "biome", "species", "gf", "decid_green", "needle_broad", "c3_c4", "n2_fixer", "log_ll", "log_lma", "log_nmass", "log_narea", "log_pmass", "log_parea", "log_amass", "log_aarea", "log_gs", "log_rdmass", "log_rdarea", "ca_ci")

# get rid of empty columns
glopnet <- glopnet %>%
  select(code, dataset, biome, species, gf, decid_green, needle_broad, c3_c4, n2_fixer, log_ll, log_lma, log_nmass, log_narea, log_pmass, log_parea, log_amass, log_aarea, log_gs, log_rdmass, log_rdarea, ca_ci)

# NOTES: 
  # no data for: PIJE, QUKE, QUWI, PSMA, ABCO
# isolate data on PIPO
glopnet_pipo <- glopnet %>%
  filter(species == "Pinus ponderosa")

# isolate data on QUCH
glopnet_quch <- glopnet %>%
  filter(species == "Quercus chapmanii")

# isolate data on UMCA
glopnet_umca <- glopnet %>%
  filter(species == "Umbellularia californica")
```

## try database setup
```{r}
# specific leaf area (calc. wtd values)
# read in data from TRY database
try_sla <- read_csv("data/Traits/try-sla.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id==c("3117")) %>% # only include rows with SLA measurements (exclude rows w/ other data measurements)
  mutate(species_name = str_replace(species_name, "Pinus ponderosa Douglas ex C.Lawson", "Pinus ponderosa")) %>%
  mutate(species_name = str_replace(species_name, "Pinus ponderosa Dougl. ex P. & C. Laws.", "Pinus ponderosa")) %>%
  mutate(species_name = str_replace(species_name, "Quercus keloggii", "Quercus kelloggii")) %>%
  mutate(std_value = as.numeric(std_value))

unique(try_sla$species_name) # determine the species included in the SLA data

# calculate mean value of SLA for each species
mean_try_sla <- try_sla %>%
  group_by(species_name) %>%
  summarise(mean_sla = mean(std_value)) %>%
  mutate(unit = rep("mm2/mg", length = 6))

# calculate weighted trait val (trait value x species abundance)
## laguna mountain
laguna_sla_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(sla_wtd = abundance*3.182446)

laguna_sla_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(sla_wtd = abundance*9.012142)

laguna_sla_wtd <- c(laguna_sla_pije$sla_wtd, laguna_sla_quke$sla_wtd)

l_abundance <- l_abundance %>%
  mutate(sla_wtd = laguna_sla_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_sla_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(sla_wtd = abundance*3.182446)

bm_sla_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(sla_wtd = abundance*5.709716)

bm_sla_wtd <- c(bm_sla_pije$sla_wtd, bm_sla_abco$sla_wtd)

bm_abundance <- bm_abundance %>%
  mutate(sla_wtd = bm_sla_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf length
# read in data from TRY database
try_ll <- read_csv("data/Traits/try-ll.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id==c("940")) %>% # only include rows with leaf length measurements (exclude rows w/ other data measurements)
  mutate(std_value = as.numeric(std_value))

unique(try_ll$species_name) # determine the species included in the SLA data

# calculate mean value of leaf length for each species
mean_try_ll <- try_ll %>%
  group_by(species_name) %>%
  summarise(mean_ll = mean(std_value)) %>%
  mutate(unit = rep("cm", length = 9))

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_ll_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(ll_wtd = abundance*19.666667)

laguna_ll_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(ll_wtd = abundance*13.000000)

laguna_ll_wtd <- c(laguna_ll_pije$ll_wtd, laguna_ll_quke$ll_wtd)

l_abundance <- l_abundance %>%
  mutate(ll_wtd = laguna_ll_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_ll_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(ll_wtd = abundance*19.666667)

bm_ll_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(ll_wtd = abundance*3.000000)

bm_ll_wtd <- c(bm_ll_pije$ll_wtd, bm_ll_abco$ll_wtd)

bm_abundance <- bm_abundance %>%
  mutate(ll_wtd = bm_ll_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf width
# read in data from TRY database
try_width <- read_csv("data/Traits/try-width.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id==c("145")) %>% # only include rows with leaf width measurements (exclude rows w/ other data measurements)
  mutate(std_value = as.numeric(std_value))

unique(try_width$species_name) # determine the species included in the leaf width data

# calculate mean value of leaf length for each species
mean_try_width <- try_width %>%
  group_by(species_name) %>%
  summarise(mean_width = mean(std_value)) %>%
  mutate(unit = rep("cm", length = 9))

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_width_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(width_wtd = abundance*0.1750000)

laguna_width_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(width_wtd = abundance*9.0000000)

laguna_width_wtd <- c(laguna_width_pije$width_wtd, laguna_width_quke$width_wtd)

l_abundance <- l_abundance %>%
  mutate(width_wtd = laguna_width_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_width_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(width_wtd = abundance*0.1750000)

bm_width_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(width_wtd = abundance*0.2076364)

bm_width_wtd <- c(bm_width_pije$width_wtd, bm_width_abco$width_wtd)

bm_abundance <- bm_abundance %>%
  mutate(width_wtd = bm_width_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# plant height vegetative
# read in data from TRY database
try_height <- read_csv("data/Traits/try-height.csv")%>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id==c("3106")) %>% # only include rows with leaf width measurements (exclude rows w/ other data measurements)
  mutate(std_value = as.numeric(std_value)) %>%
  mutate(species_name = str_replace(species_name, "Abies concolor (Gord. & Glend.) Lindl. ex Hildebr.", "Abies concolor")) %>%
  mutate(species_name = str_replace(species_name, "Pinus jeffreyi Balf", "Pinus jeffreyi")) %>%
  mutate(species_name = str_replace(species_name, "Pinus jeffreyi.", "Pinus jeffreyi")) %>%
  mutate(species_name = str_replace(species_name, "Pinus ponderosa C. Lawson", "Pinus ponderosa")) %>%
  mutate(species_name = str_replace(species_name, "Quercus kelloggii Newberry", "Quercus kelloggii")) %>%
  mutate(species_name = str_replace(species_name, "Quercus chapmanii Sarg.", "Quercus chapmanii")) %>%
  mutate(species_name = str_replace(species_name, "Quercus kelloggii Newb.", "Quercus kelloggii")) %>%
  mutate(species_name = str_replace(species_name, "Pinus ponderosa Dougl. Ex Laws.", "Pinus ponderosa")) 

unique(try_height$species_name) # determine the species included in the leaf height data

# calculate mean value of plant height for each species
mean_try_height <- try_height %>%
  group_by(species_name) %>%
  summarise(mean_height = mean(std_value)) %>%
  mutate(unit = rep("m", length = 16)) 

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_height_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(height_wtd = abundance*50.195111)

laguna_height_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(height_wtd = abundance*27.307657)

laguna_height_wtd <- c(laguna_height_pije$height_wtd, laguna_height_quke$height_wtd)

l_abundance <- l_abundance %>%
  mutate(height_wtd = laguna_height_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_height_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(height_wtd = abundance*50.195111)

bm_height_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(height_wtd = abundance*46.662545) # NOT ACCURATE

bm_height_wtd <- c(bm_height_pije$height_wtd, bm_height_abco$height_wtd)

bm_abundance <- bm_abundance %>%
  mutate(height_wtd = bm_height_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf curling
# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_curl_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(curl_wtd = rep(0, length = l_abundance))

laguna_curl_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(curl_wtd = abundance*33.83)

laguna_curl_wtd <- c(laguna_curl_pije$curl_wtd, laguna_curl_quke$curl_wtd)

l_abundance <- l_abundance %>%
  mutate(curl_wtd = laguna_curl_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_curl_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(curl_wtd = rep(0, length = bm_abundance))

bm_curl_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(curl_wtd = rep(0, length = bm_abundance))

bm_curl_wtd <- c(bm_curl_pije$curl_wtd, bm_curl_abco$curl_wtd)

bm_abundance <- bm_abundance %>%
  mutate(curl_wtd = bm_curl_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf N content per leaf area
# read in data from TRY database
try_N_la <- read_csv("data/Traits/try-n_p.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id=="50") %>%
  mutate(std_value = as.numeric(std_value)) %>%
  mutate(species_name = str_replace(species_name, "Quercus keloggii", "Quercus kelloggii")) 

unique(try_N_la$species_name) # determine species included in N content per leaf area data

# calculate mean value of leaf N content per leaf area for each species
mean_try_N_la <- try_N_la %>%
  group_by(species_name) %>%
  summarise(mean_N_la = mean(std_value)) %>%
  mutate(unit = rep("g/m2", length = 3)) 

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_n_la_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(n_la_wtd = abundance*3.336761)

laguna_n_la_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(n_la_wtd = abundance*1.741306)

laguna_n_la_wtd <- c(laguna_n_la_pije$n_la_wtd, laguna_n_la_quke$n_la_wtd)

l_abundance <- l_abundance %>%
  mutate(n_la_wtd = laguna_n_la_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_n_la_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(n_la_wtd = abundance*3.336761)

bm_n_la_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(n_la_wtd = abundance*3.873892) 

bm_n_la_wtd <- c(bm_n_la_pije$n_la_wtd, bm_n_la_abco$n_la_wtd)

bm_abundance <- bm_abundance %>%
  mutate(n_la_wtd = bm_n_la_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf N content per leaf dry mass
# read in data from TRY database
try_N_ldm <- read_csv("data/Traits/try-n_p.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id=="14") %>%
  mutate(std_value = as.numeric(std_value)) %>%
  mutate(species_name = str_replace(species_name, "Quercus keloggii", "Quercus kelloggii")) 

unique(try_N_ldm$species_name) # determine species included in N content per leaf area data

# calculate mean value of leaf N content per leaf area for each species
mean_try_N_ldm <- try_N_ldm %>%
  group_by(species_name) %>%
  summarise(mean_N_ldm = mean(std_value)) %>%
  mutate(unit = rep("mg/g", length = 3)) 

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_n_ldm_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(n_ldm_wtd = abundance*11.17233)

laguna_n_ldm_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(n_ldm_wtd = abundance*17.12167)

laguna_n_ldm_wtd <- c(laguna_n_ldm_pije$n_ldm_wtd, laguna_n_ldm_quke$n_ldm_wtd)

l_abundance <- l_abundance %>%
  mutate(n_ldm_wtd = laguna_n_ldm_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_n_ldm_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(n_ldm_wtd = abundance*11.17233)

bm_n_ldm_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(n_ldm_wtd = abundance*12.66867) 

bm_n_ldm_wtd <- c(bm_n_ldm_pije$n_ldm_wtd, bm_n_ldm_abco$n_ldm_wtd)

bm_abundance <- bm_abundance %>%
  mutate(n_ldm_wtd = bm_n_ldm_wtd) %>%
  mutate(plot_id = as.character(plot_id))

# leaf P content per leaf area
# read in data from TRY database
try_P_la <- read_csv("data/Traits/try-n_p.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id=="51") %>%
  mutate(std_value = as.numeric(std_value))
 
unique(try_P_la$species_name) # determine species included in N content per leaf area data --> no data for QUKE

# leaf P content per leaf dry mass
# read in data from TRY database
try_P_ldm <- read_csv("data/Traits/try-n_p.csv") %>%
  clean_names() %>%
  select(dataset_id, dataset, species_name, trait_id, trait_name, data_name, orig_value_str, orig_unit_str, std_value, unit_name) %>%
  filter(trait_id=="15") %>%
  mutate(std_value = as.numeric(std_value)) 

unique(try_P_ldm$species_name) # determine species included in N content per leaf area data

# calculate mean value of leaf N content per leaf area for each species
mean_try_P_ldm <- try_P_ldm %>%
  group_by(species_name) %>%
  summarise(mean_P_ldm = mean(std_value)) %>%
  mutate(unit = rep("mg/g", length = 3)) 

# calculate weighted trait value (trait value x species abundance)
## laguna mountain
laguna_p_ldm_pije <- l_abundance %>%
  filter(species == "PIJE") %>%
  mutate(p_ldm_wtd = abundance*1.174033)

laguna_p_ldm_quke <- l_abundance %>%
  filter(species == "QUKE") %>%
  mutate(p_ldm_wtd = abundance*2.235000)

laguna_p_ldm_wtd <- c(laguna_p_ldm_pije$p_ldm_wtd, laguna_p_ldm_quke$p_ldm_wtd)

l_abundance <- l_abundance %>%
  mutate(p_ldm_wtd = laguna_p_ldm_wtd) %>%
  mutate(plot_id = as.character(plot_id))

## bluff mesa
bm_p_ldm_pije <- bm_abundance %>%
  filter(species == "PIJE") %>%
  mutate(p_ldm_wtd = abundance*1.174033)

bm_p_ldm_abco <- bm_abundance %>%
  filter(species == "ABCO") %>%
  mutate(p_ldm_wtd = abundance*1.348615) 

bm_p_ldm_wtd <- c(bm_p_ldm_pije$p_ldm_wtd, bm_p_ldm_abco$p_ldm_wtd)

bm_abundance <- bm_abundance %>%
  mutate(p_ldm_wtd = bm_p_ldm_wtd) %>%
  mutate(plot_id = as.character(plot_id))
```

### community weighted means
```{r}
# calculate community weighted mean (PER PLOT)
laguna_cwm <- l_abundance %>%
  group_by(plot_id) %>%
  mutate(sla_cwm = (sum(sla_wtd))/sum(abundance)) %>%
  mutate(ll_cwm = (sum(ll_wtd))/sum(abundance)) %>%
  mutate(width_cwm = (sum(width_wtd))/sum(abundance)) %>%
  mutate(height_cwm = (sum(height_wtd))/sum(abundance)) %>%
  mutate(curl_cwm = (sum(curl_wtd))/sum(abundance)) %>%
  mutate(n_la_cwm = (sum(n_la_wtd))/sum(abundance)) %>%
  mutate(n_ldm_cwm = (sum(n_ldm_wtd))/sum(abundance)) %>%
  mutate(p_ldm_cwm = (sum(p_ldm_wtd))/sum(abundance))

# calculate community weighted mean (PER PLOT)
bluffmesa_cwm <- bm_abundance %>%
  group_by(plot_id) %>%
  mutate(sla_cwm = (sum(sla_wtd))/sum(abundance)) %>%
  mutate(ll_cwm = (sum(ll_wtd))/sum(abundance)) %>%
  mutate(width_cwm = (sum(width_wtd))/sum(abundance)) %>%
  mutate(height_cwm = (sum(height_wtd))/sum(abundance)) %>%
  mutate(curl_cwm = (sum(curl_wtd))/sum(abundance)) %>%
  mutate(n_la_cwm = (sum(n_la_wtd))/sum(abundance)) %>%
  mutate(n_ldm_cwm = (sum(n_ldm_wtd))/sum(abundance)) %>%
  mutate(p_ldm_cwm = (sum(p_ldm_wtd))/sum(abundance))
```

# data visualization
## abundance
```{r}
# combine laguna & bm abundance data
abundance_raw <- rbind(l_abundance, bm_abundance) %>%
  select(c(project, species, abundance))

print(abundance_raw$plot_id)

# create vectors
variable <- rep(c("row_num", "Abundance"), 77)
plot_id <- c(rep(128, 2), rep(129, 2), rep(130, 2), rep(131, 2), rep(132, 2), rep(133, 2), rep(134, 2), rep(135, 2), rep(137, 2), rep(138, 2), rep(139, 2), rep(140, 2), rep(141, 2), rep(142, 2), rep(143, 2), rep(144, 2), rep(145, 2), rep(170, 2), rep(171, 2), rep(172, 2), rep(173, 2), rep(175, 2), rep(176, 2), rep(177, 2), rep(179, 2), rep(180, 2), rep(181, 2), rep(195, 2), rep(197, 2), rep(198, 2), rep(199, 2), rep(200, 2), rep(128, 2), rep(129, 2), rep(130, 2), rep(131, 2), rep(133, 2), rep(134, 2), rep(135, 2), rep(137, 2), rep(138, 2), rep(139, 2), rep(141, 2), rep(142, 2), rep(143, 2), rep(144, 2), rep(170, 2), rep(171, 2), rep(172, 2), rep(173, 2), rep(175, 2), rep(177, 2), rep(179, 2), rep(180, 2), rep(181, 2), rep(195, 2), rep(196, 2), rep(197, 2), rep(198, 2), rep(199, 2), rep(200, 2), rep(24, 2), rep(25, 2), rep(26, 2), rep(27, 2), rep(33, 2), rep(49, 2), rep(50, 2), rep(51, 2), rep(52, 2), rep(53, 2), rep(24, 2), rep(26, 2), rep(33, 2), rep(48, 2), rep(49, 2), rep(52, 2))
value <- c(1, 0.287818153, 2, 0.314813660, 3, 0.392261532, 4, 0.160015467, 5, 0.212455165, 6, 0.253615201, 7, 0.313409674, 8, 0.202621388, 9, 0.305246887, 10, 0.089103884, 11, 0.267856919, 12, 0.129019207, 13, 0.148012053, 14, 0.198904378, 15, 0.114283470, 16, 0.207206369, 17, 0.029744009, 18, 0.012035251, 19, 0.089825016, 20, 0.017759026, 21, 0.009390125, 22, 0.040769295, 23, 0.011888362, 24, 0.048106009, 25, 0.037420706, 26, 0.072318359, 27, 0.015791370, 28, 0.136926541, 29, 0.085321678, 30, 0.035760876, 31, 0.001957867, 32, 0.084420423, 33, 0.354779881, 34, 0.048346562, 35, 0.107770188, 36, 0.123975868, 37, 0.086345359, 38, 0.171812232, 39, 0.079467872, 40, 0.410841468, 41, 0.059759213, 42, 0.000000000, 43, 0.316010208, 44, 0.047450804, 45, 0.143419240, 46, 0.027949359, 47, 0.383993188, 48, 0.244201954, 49, 0.254060772, 50, 0.313916775, 51, 0.351361515, 52, 0.093259572, 53, 0.483630431, 54, 0.276800442, 55, 0.324071979, 56, 0.319153438, 57, 0.186176328, 58, 0.057445953, 59, 0.104646946, 60, 0.420025617, 61, 0.299296319, 62, 0.340911768, 63, 0.105491180, 64, 0.109314173, 65, 0.340050263, 66, 0.305090823, 67, 0.114166586, 68, 0.115842923, 69, 0.131598372, 70, 0.018538687, 71, 0.144114770, 72, 0.033583031, 73, NA, 74, 0.127012168, 75, 0.141486105, 76, 0.876216111, 77, 0.032622407)
species <- c(rep("PIJE", 62), rep("QUKE", 60), rep("PIJE", 20), rep("ABCO", 12))
location <- c(rep("Laguna Mountain", 61), rep("Bluff Mesa", 16))

abundance_arrange <- data.frame(plot_id, species, variable, value) %>%
  filter(!variable=="row_num") %>%
  mutate(location=location) %>%
  slice(-73) %>%
  mutate(plot_id = as.factor(plot_id))

abundance_bar <- ggplot(abundance_arrange, aes(fill=species, y=value, x=plot_id)) + 
    geom_bar(position="stack", stat="identity") +
    facet_wrap(~location, scales = "free_x") +
    theme_minimal() +
    theme(axis.text.x = element_blank(),
          axis.title = element_text(face = 'bold', size = 16)) +
    xlab("Plot") +
    ylab("Abundance") +
    scale_fill_brewer(palette = "Paired")

abundance_bar
```

## leaf trait bar plots
```{r}
# species IDs: 42135, 45408, 39, 42168, 45504, 45342, 44566, 55485
# traits: dispersal syndrome, specific leaf area (undefined petiole), leaf compoundness, leaf length (excluding petiole), leaf N content per leaf dry mass, leaf phenology type, leaf width, photosynthesis pathway, plant growth form, plant height vegetative, plant lifespan, plant N fixation capacity, plant woodiness, species tolerance to drought
# trait IDs: 28, 3117, 17, 940, 14, 37, 145, 22, 42, 3106, 59, 8, 38, 30
# final traits: 3117, 17, 940, 145, 3106

# laguna mountain all leaf traits
# create a dataset
l_trait_clean <- laguna_cwm %>%
  select(plot_id, sla_cwm, ll_cwm, width_cwm, height_cwm, curl_cwm, n_la_cwm, n_ldm_cwm, p_ldm_cwm) %>%
  distinct()

trait <- rep(c("row_num", "plot_id", "Spec leaf area (mm2/mg)" , "Leaf length (cm)" , "Leaf width (cm)", "Plant height (m)", "Leaf curl height (mm)") , 32)
plot_id <- c(rep("128" , 7) , rep("129" , 7) , rep("130" , 7) , rep("131" , 7), rep("132" , 7), rep("133" , 7), rep("134" , 7), rep("135" , 7), rep("137" , 7), rep("138" , 7), rep("139" , 7), rep("140" , 7), rep("141" , 7), rep("142" , 7), rep("143" , 7), rep("144" , 7), rep("170" , 7), rep("171" , 7), rep("172" , 7), rep("173" , 7), rep("175" , 7), rep("176" , 7), rep("177" , 7), rep("179" , 7), rep("180" , 7), rep("181" , 7), rep("195" , 7), rep("197" , 7), rep("198" , 7), rep("199" , 7), rep("200" , 7), rep("196" , 7))
cwm <- c(1,128,4.504570,18.15473,2.176432,45.00444,7.672345,2,129,6.271273,16.13438,4.850870,38.06834,17.924610,3,130,3.822120,18.93515,1.143340,47.68374,3.712061,4,131,5.528604,16.98367,3.726616,40.98407,13.614865,5,132,3.182446,19.66667,0.175000,50.19511,0.000000,6,133,5.096532,17.47778,3.072545,42.68039,11.107529,7,134,4.441635,18.22670,2.081162,45.25152,7.307134,8,135,5.857454,16.60761,4.224431,39.69300,15.523200,9,137,4.386646,18.28958,1.997919,45.46741,6.988030,10,138,7.973131,14.18818,7.427145,31.38682,27.800572,11,139,4.245819,18.45063,1.784735,46.02030,6.170802,12,140,3.182446,19.66667,0.175000,50.19511,0.000000,13,141,3.182446,19.66667,0.175000,50.19511,0.000000,14,142,6.760211,15.57524,5.591025,36.14876,20.761939,15,143,4.892806,17.71075,2.764144,43.48022,9.925297,16,144,5.567014,16.93975,3.784761,40.83327,13.837760,17,170,6.006623,16.43702,4.450242,39.10736,16.388830,18,171,8.834978,13.20260,8.731809,28.00320,32.801911,19,172,7.444447,14.79277,6.626821,33.46245,24.732590,20,173,8.631266,13.43556,8.423429,28.80298,31.619757,21,175,8.842824,13.19363,8.743687,27.97240,32.847442,22,176,8.406037,13.69312,8.082477,29.68723,30.312742,23,177,8.353018,13.75375,8.002217,29.89539,30.005072,24,179,8.484731,13.60313,8.201605,29.37828,30.769412,25,180,8.317881,13.79394,7.949028,30.03333,29.801173,26,181,7.948559,14.21628,7.389947,31.48330,27.657978,27,195,8.737294,13.31431,8.583935,28.38671,32.235045,28,197,4.905388,17.69636,2.783191,43.43082,9.998311,29,198,6.393818,15.99424,5.036378,37.58723,18.635742,30,199,8.554746,13.52306,8.307593,29.10340,31.175708,31,200,8.974255,13.04333,8.942646,27.45640,33.610137,32,196,9.012142,13.00000,9.000000,27.30766,33.830000)
laguna_cwm_arrange <- data.frame(plot_id, trait, cwm) %>%
  filter(!trait=="plot_id") %>%
  filter(!trait=="row_num")

# small multiple trait graphs
laguna_cwm_plot <- ggplot(laguna_cwm_arrange, aes(fill=plot_id, y=cwm, x=plot_id)) + 
    geom_bar(position="dodge", stat="identity") +
    ggtitle("Functional trait value distribution at Laguna Mountain") +
    facet_wrap(~trait, scales="free_y") +
    xlab("Plot") +
    ylab("Community weighted mean") +
    theme(axis.text.x = element_blank()) +
    theme(axis.ticks.x = element_blank())

# bluff mesa all leaf traits
b_trait_clean <- bluffmesa_cwm %>%
  select(plot_id, sla_cwm, ll_cwm, width_cwm, height_cwm, curl_cwm, n_la_cwm, n_ldm_cwm, p_ldm_cwm) %>%
  distinct()

# create a dataframe
trait <- rep(c("row_num", "plot_id", "Spec leaf area (mm2/mg)" , "Leaf length (cm)" , "Leaf width (cm)", "Plant height (m)", "Leaf curl height (mm)") , 11)
plot_id <- c(rep("24" , 7) ,rep("25" , 7) ,rep("26" , 7) ,rep("27" , 7) ,rep("33" , 7) ,rep("49" , 7) ,rep("50" , 7) ,rep("51" , 7) ,rep("52" , 7) ,rep("53" , 7) ,rep("48" , 7))
cwm <- c(1,24,3.409080,18.172074,0.1779267,49.87833,0,2,25,3.182446,19.666667,0.1750000,50.19511,0,3,26,NA,NA,NA,NA,NA,4,27,3.182446,19.666667,0.1750000,50.19511,0,5,33,3.925311,14.767674,0.1845931,49.15675,0,6,49,5.418384,4.921254,0.2038742,47.06976,0,7,50,3.182446,19.666667,0.1750000,50.19511,0,8,51,3.182446,19.666667,0.1750000,50.19511,0,9,52,4.793937,9.039318,0.1958103,47.94260,0,10,53,3.182446,19.666667,0.1750000,50.19511,0,11,48,5.709716,3.000000,0.2076364,46.66255,0)
bm_cwm_arrange <- data.frame(plot_id, trait, cwm) %>%
  filter(!trait=="plot_id") %>%
  filter(!trait=="row_num") %>%
  filter(!plot_id=="26")

# small multiple trait graphs
bm_cwm_plot <- ggplot(bm_cwm_arrange, aes(fill=plot_id, y=cwm, x=plot_id)) + 
    geom_bar(position="dodge", stat="identity") +
    ggtitle("Functional trait value distribution at Bluff Mesa") +
    facet_wrap(~trait, scales="free_y") +
    xlab("Plot") +
    ylab("Community weighted mean") +
    theme(axis.text.x = element_blank()) +
    theme(axis.ticks.x = element_blank())

# display plots
laguna_cwm_plot
bm_cwm_plot
```

## fire severity & fuels boxplots
### fire severity
```{r}
# make plot ID a factor
postfire_whole <- postfire_whole %>%
  mutate(plot_id = as.factor(plot_id))

# faceted boxplot of char height at Laguna & Bluff Mesa
char_box <- ggplot(postfire_whole, aes(x=reorder(plot_id, char_ht, na.rm = TRUE), y=char_ht, fill=location)) + 
    geom_boxplot() +
    facet_wrap(~location, scales = "free_x") +
    theme(axis.text.x = element_blank()) +
    theme(axis.ticks.x = element_blank()) +
    ggtitle("Post-fire char height per plot") +
    xlab("Plot") +
    ylab("Char height (m)") +
    scale_fill_brewer(palette = "Accent")

# faceted boxplot of scorch height at Laguna & Bluff Mesa
scorch_box <- ggplot(postfire_whole, aes(x=reorder(plot_id, scorch_ht, na.rm = TRUE), y=scorch_ht, fill=location)) + 
    geom_boxplot() +
    facet_wrap(~location, scales = "free_x") +
    theme(axis.text.x = element_blank()) +
    theme(axis.ticks.x = element_blank()) +
    ggtitle("Post-fire scorch height per plot") +
    xlab("Plot") +
    ylab("Scorch height (m)") +
    scale_fill_brewer(palette = "Accent")

# faceted boxplot of char height at Laguna & Bluff Mesa
csp_box <- ggplot(postfire_whole, aes(x=reorder(plot_id, cr_sc_pct, na.rm = TRUE), y=cr_sc_pct, fill=location)) + 
    geom_boxplot() +
    facet_wrap(~location, scales = "free_x") +
    theme(axis.text.x = element_blank()) +
    theme(axis.ticks.x = element_blank()) +
    ggtitle("Post-fire crown scorch per plot") +
    xlab("Plot") +
    ylab("Crown scorch (%)") +
    scale_fill_brewer(palette = "Accent")

# display plot
char_box
scorch_box
csp_box
```

### fuels
```{r}
# bar plot of fuel distribution in laguna mountain (tons per acre)
# rearrange fuels data frame for graphing purposes
fuels_clean <- fuels_whole %>%
  select(c("one_hr", "ten_hr", "hun_hr", "fine_wood", "total_wood", "duff", "litter", "total_all"))

plot_id <- c(rep("128" , 9) , rep("129" , 9) , rep("130" , 9) , rep("131" , 9), rep("132" , 9), rep("133" , 9), rep("134" , 9), rep("135" , 9), rep("136" , 9), rep("137" , 9), rep("138" , 9), rep("139" , 9), rep("140" , 9), rep("141" , 9), rep("142" , 9), rep("143" , 9), rep("144" , 9), rep("145" , 9), rep("170" , 9), rep("171" , 9), rep("172" , 9), rep("173" , 9), rep("175" , 9), rep("176" , 9), rep("177" , 9), rep("179" , 9), rep("180" , 9), rep("181" , 9), rep("195" , 9), rep("196" , 9), rep("197" , 9), rep("198" , 9), rep("199" , 9), rep("200" , 9), rep("24" , 9), rep("25" , 9), rep("26" , 9), rep("27" , 9), rep("33" , 9), rep("48" , 9), rep("49" , 9), rep("50" , 9), rep("51" , 9), rep("52" , 9), rep("53" , 9))
fuel_class <- rep(c("row_num", "one_hr", "ten_hr", "hun_hr", "fine_wood", "total_wood", "duff", "litter", "total_all") , 45)
value <- c(1,0.07286660,1.5311482,1.1065791,2.7105939,2.7105939,11.7903308,10.5621713,25.063096,2,0.11701969,0.5615723,0.0000000,0.6785920,4.0387772,25.5457166,5.8951654,35.479659,3,0.00000000,0.5561763,0.5546157,1.1107920,25.6230254,5.8951654,8.8427481,40.360939,4,0.14587863,1.3959908,0.0000000,1.5418695,12.1293769,9.1702573,9.8252756,31.124910,5,0.08006543,1.5312136,1.6611130,3.2723920,3.2723920,6.8776929,2.9475827,13.097668,6,0.32486280,2.3750259,8.3339310,11.0338197,45.5945904,17.6854961,7.6145886,70.894675,
7,0.18302808,1.4169661,2.8284521,4.4284463,6.6141039,18.1767599,6.8776929,31.668557,8,0.11098889,0.9994838,0.5594515,1.6699242,1.6699242,10.8078032,6.6320610,19.109788,9,0.16890525,0.9750101,1.1085137,2.2524291,24.2447949,3.9301102,3.1932146,31.368120,10,0.19965237,1.2647811,5.0506518,6.5150852,10.8649686,3.4388465,2.5054453,16.809260,11,0.27115026,2.6550207,3.9006964,6.8268673,9.0325722,4.9126378,3.4388465,17.384057,12,0.25433618,2.2252125,0.5535108,3.0330595,3.0330595,15.2291772,4.9126378,23.174875,13,0.10286367,3.3561092,1.6721957,5.1311686,5.1311686,5.8951654,2.4563189,13.482653,14,0.13116969,0.4180056,0.5565991,1.1057744,2.1586417,10.3165394,3.9301102,16.405291,15,0.06009012,1.2694177,0.5546157,1.8841235,1.8841235,9.3340118,2.7019508,13.920086,16,0.40033582,1.6715361,0.0000000,2.0718719,17.5142009,12.2815945,4.4213740,34.217169,17,0.13885178,0.2794611,0.5565991,0.9749120,0.9749120,6.3864292,3.1932146,10.554556,18,0.29165134,0.4188998,1.1131981,1.8237493,4.7605668,5.4039016,2.9475827,13.112051,19,0.19040356,0.8374677,1.6697133,2.6975846,7.6220683,15.7204410,11.7903308,35.132840,20,0.14751377,2.1129278,6.1980263,8.4584679,11.9834688,5.8951654,4.9126378,22.791272,21,0.21105743,0.5568845,0.0000000,0.7679420,1.5547787,15.7204410,10.8078032,28.083023,22,0.25574046,0.5593579,1.1126204,1.9277187,3.4209869,7.3689567,7.1233248,17.913268,23,0.14679300,1.5472038,2.8014944,4.4954912,9.2677899,4.9126378,7.8602205,22.040648,24,0.10907846,1.5294848,2.2131582,3.8517214,35.7175201,10.8078032,19.1592875,65.684611,25,0.16026171,0.4190387,2.2240540,2.8033544,2.8033544,6.3864292,8.1058524,17.295636,26,0.10190950,0.2791982,0.0000000,0.3811077,20.3414066,15.2291772,8.3514843,43.922068,27,0.30533411,2.2262686,3.8746859,6.4062887,6.4062887,3.9301102,8.1058524,18.442251,28,0.24707121,2.3659370,4.4301857,7.0431939,36.4335886,6.8776929,6.1407973,49.452079,29,0.30571921,1.8110931,4.4337772,6.5505895,6.5505895,2.4563189,12.2815945,21.288503,30,0.43697333,0.8366800,1.1096452,2.3832986,2.3832986,7.8602205,10.0709075,20.314427,31,0.08739492,1.8165712,0.5572311,2.4611972,10.7058241,4.9126378,13.7553859,29.373848,32,0.16725350,1.6697796,1.1087338,2.9457670,9.0553734,9.8252756,10.5621713,29.442820,33,0.20738127,0.9789246,1.1079061,2.2942119,5.4982115,7.3689567,8.8427481,21.709916,34,0.10969936,0.1395991,0.0000000,0.2492984,0.2492984,2.9475827,7.8602205,11.057102,35,0.06662546,1.3298550,1.1136870,2.5101675,2.5101675,1.4737913,4.0529262,8.036885,36,0.13967926,1.3627371,1.7185069,3.2209233,5.6556004,2.4563189,5.0354538,13.147373,37,0.05185996,2.1217591,4.7919836,6.9656027,34.2362489,13.241221,7.4917727,54.992144,38,0.03641706,2.8615913,2.4979603,5.3959687,6.9345870,5.8951654,6.3864292,19.216182,39,0.04026644,1.9533576,5.5520655,7.5456896,55.9919268,4.9126378,4.6670059,65.571571,40,0.14194555,1.4636174,1.3845898,2.9901527,13.6245972,9.3340118,3.1932146,26.151824,41,5.35452419,62.4531504,4.4369204,72.2445949,122.3172201,14.9835453,9.2111959,146.511961,42,0.05482247,1.3339584,1.1136209,2.5024018,3.5741730,7.6145886,10.9306191,22.119381,43,0.01819408,0.4228684,0.0000000,0.4410624,0.9762021,0.0000000,0.3684478,1.344650,44,0.25937571,2.2356683,1.9553014,4.4503454,11.2909432,0.4912638,1.5966073,13.378814,45,0.09109381,10.0541141,0.8328735,10.9780814,12.2757569,6.3864292,5.6495335,24.311719)
location <- c(rep("Laguna Mountain", 272), rep("Bluff Mesa", 88))
# create data frame
fuels_arrange <- data.frame(plot_id, fuel_class, value) %>%
  filter(!fuel_class=="row_num") %>%
  mutate(location=location) 
  
fuel_class <- fuels_arrange %>%
  filter(fuel_class=="one_hr" | fuel_class=="ten_hr" | fuel_class=="hun_hr") %>%
  mutate(fuel_class=factor(fuel_class, levels=c("hun_hr", "ten_hr", "one_hr")))

# filter fuels data frame to only include fuels at laguna
lm_fuel_class <- fuel_class %>%
  filter(location=="Laguna Mountain")

# stacked bar plot for fuel classes
lm_class_plot <- ggplot(lm_fuel_class, aes(fill=fuel_class, y=value, x=reorder(plot_id, value))) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Fuel loading distribution at Laguna Mountain") +
  xlab("Plot") +
  ylab("Fuel loading (tons/acre)") +
  scale_fill_brewer(palette = "Paired")

# filter fuels data frame to only include fuels at bluff mesa
bm_fuel_class <- fuel_class %>%
  filter(location=="Bluff Mesa")

# stacked bar plot for fuel classes
bm_class_plot <- ggplot(bm_fuel_class, aes(fill=fuel_class, y=value, x=reorder(plot_id, value))) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Fuel loading distribution at Bluff Mesa") +
  xlab("Plot") +
  ylab("Fuel loading (tons/acre)") +
  scale_fill_brewer(palette = "Paired")

# display fuel classes bar plots
lm_class_plot
bm_class_plot

duff_litter <- fuels_arrange %>%
  filter(fuel_class=="duff" | fuel_class=="litter")

# filter fuels data frame to only include fuels at laguna
lm_duff_litter <- duff_litter %>%
  filter(location=="Laguna Mountain")

# filter fuels data frame to only include fuels at bluff mesa
bm_duff_litter <- duff_litter %>%
  filter(location=="Bluff Mesa")

# stacked barplot for duff and litter
lm_duff_plot <- ggplot(lm_duff_litter, aes(fill=fuel_class, y=value, x=reorder(plot_id, value))) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Fuel loading distribution at Bluff Mesa") +
  xlab("Plot") +
  ylab("Fuel loading (tons/acre)") +
  scale_fill_brewer(palette = "Paired")

# stacked barplot for duff and litter
bm_duff_plot <- ggplot(bm_duff_litter, aes(fill=fuel_class, y=value, x=reorder(plot_id, value))) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Fuel loading distribution at Bluff Mesa") +
  xlab("Plot") +
  ylab("Fuel loading (tons/acre)") +
  scale_fill_brewer(palette = "Paired")

# display duff and litter plots
lm_duff_plot
bm_duff_plot
```

## fire severity vs. leaf trait scatterplots
```{r}
# calculate mean char height per plot
mean_char_ht <- postfire_whole %>%
  group_by(plot_id) %>%
  summarise(mean_char_ht = mean(char_ht))

# build data frame
bm_char_scatter <- bm_cwm_arrange %>%
  mutate(char_ht = case_match(
    plot_id,
    "24" ~ "0.0000000",
    "25" ~ "2.4750000",
    "26" ~ "0.7333333",
    "27" ~ "0.2666667",
    "33" ~ "3.0500000",
    "49" ~ "1.1550000",
    "50" ~ "1.0175000",
    "51" ~ "0.5500000",
    "52" ~ "0.7400000",
    "53" ~ "2.5800000",
    "48" ~ "0.9500000")) %>%
  mutate(char_ht=as.numeric(char_ht)) %>%
  mutate(location=rep("Bluff Mesa", 50))
  
lm_char_scatter <- laguna_cwm_arrange %>%
  mutate(char_ht = case_match(
    plot_id,
    "128" ~ "3.6500000",
    "129" ~ "0.9541667",
    "130" ~ "2.4083333",
    "131" ~ "NA",
    "132" ~ "6.6000000",
    "133" ~ "0.7500000",
    "134" ~ "5.5700000",
    "135" ~ "4.5000000",
    "137" ~ "3.3428571",
    "138" ~ "2.7428571",
    "139" ~ "2.0416667", 
    "140" ~ "1.0642857",
    "141" ~ "2.8375000",
    "142" ~ "1.9000000",
    "143" ~ "1.5400000",
    "144" ~ "0.5166667",
    "145" ~ "2.5333333",
    "170" ~ "1.4571429",
    "171" ~ "0.3387500",
    "172" ~ "1.4811111",
    "173" ~ "0.5560000",
    "175" ~ "0.7350000",
    "176" ~ "0.4928571",
    "177" ~ "0.8985714",
    "179" ~ "0.7166667",
    "180" ~ "0.1688235",
    "181" ~ "0.8110526",
    "195" ~ "0.3424000",
    "197" ~ "2.6320000",
    "198" ~ "2.4200000",
    "199" ~ "2.4183333",
    "200" ~ "0.3409091",
    "196" ~ "0.8300000"
  )) %>%
  mutate(char_ht=na_if(char_ht, "NA")) %>%
  na.omit() %>%
  mutate(char_ht=as.numeric(char_ht)) %>%
  mutate(location=rep("Laguna Mountain", 155))

char_scatter <- rbind(lm_char_scatter, bm_char_scatter)

# faceted scatterplots of char height vs traits
traits_char_plot <- ggplot(char_scatter, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    facet_wrap(~trait, scales = c("free")) +
    ggtitle("Correlations between functional traits and char height") +
    xlab("Trait community weighted mean") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplots of char height vs traits
sla_char <- char_scatter %>%
  filter(trait=="Spec leaf area (mm2/mg)")
sla_char_plot <- ggplot(sla_char, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between specific leaf area and char height") +
    xlab("Specific leaf area (mm2/mg)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ll_char <- char_scatter %>%
  filter(trait=="Leaf length (cm)")
ll_char_plot <- ggplot(ll_char, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf length and char height") +
    xlab("Leaf length (cm)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lw_char <- char_scatter %>%
  filter(trait=="Leaf width (cm)")
lw_char_plot <- ggplot(lw_char, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf width and char height") +
    xlab("Leaf width (cm)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

height_char <- char_scatter %>%
  filter(trait=="Plant height (m)")
height_char_plot <- ggplot(height_char, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between plant height and char height") +
    xlab("Plant height (m)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lc_char <- char_scatter %>%
  filter(trait=="Leaf curl height (mm)")
lc_char_plot <- ggplot(lc_char, aes(x=cwm, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf curl height and char height") +
    xlab("Leaf curl height (mm)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# calculate mean scorch height per plot
mean_scorch_ht <- postfire_whole %>%
  group_by(plot_id) %>%
  summarise(mean_scorch_ht = mean(scorch_ht))

# create data frame for scorch scatterplots
bm_scorch_scatter <- bm_cwm_arrange %>%
  mutate(scorch_ht = case_match(
    plot_id,
    "24" ~ "0.0000000",
    "25" ~ "3.0000000",
    "26" ~ "0.000000",
    "27" ~ "4.000000",
    "33" ~ "6.950000",
    "49" ~ "1.5800000",
    "50" ~ "11.0000000",
    "51" ~ "1.400000",
    "52" ~ "2.466667",
    "53" ~ "5.400000",
    "48" ~ "4.8333333")) %>%
  mutate(scorch_ht=as.numeric(scorch_ht)) %>%
  mutate(location=rep("Bluff Mesa", 50))

lm_scorch_scatter <- laguna_cwm_arrange %>%
  mutate(scorch_ht = case_match(
    plot_id,
    "128" ~ "7.8500000",
    "129" ~ "0.0000000",
    "130" ~ "6.0750000",
    "131" ~ "NA",
    "132" ~ "15.7000000",
    "133" ~ "2.2833333",
    "134" ~ "8.2500000",
    "135" ~ "3.6666667",
    "137" ~ "3.1142857",
    "138" ~ "5.2571429",
    "139" ~ "9.3166667",
    "140" ~ "2.4142857",
    "141" ~ "4.6625000",
    "142" ~ "4.8000000",
    "143" ~ "4.4100000",
    "144" ~ "0.3333333",
    "145" ~ "1.4750000",
    "170" ~ "3.8428571",
    "171" ~ "3.3250000",
    "172" ~ "2.7111111",
    "173" ~ "3.5000000",
    "175" ~ "5.6500000",
    "176" ~ "0.6285714",
    "177" ~ "0.7142857",
    "179" ~ "0.6333333",
    "180" ~ "0.3235294",
    "181" ~ "1.3473684",
    "195" ~ "0.4000000",
    "197" ~ "6.1200000",
    "198" ~ "6.2000000",
    "199" ~ "6.2666667",
    "200" ~ "2.1272727",
    "196" ~ "0.0000000"
  )) %>%
  mutate(scorch_ht=na_if(scorch_ht, "NA")) %>%
  na.omit() %>%
  mutate(scorch_ht=as.numeric(scorch_ht)) %>%
  mutate(location=rep("Laguna Mountain", 155))

scorch_scatter <- rbind(lm_scorch_scatter, bm_scorch_scatter)

# faceted scatterplots of scorch height vs traits
traits_scorch_plot <- ggplot(scorch_scatter, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    facet_wrap(~trait, scales = c("free")) +
    ggtitle("Correlations between functional traits and scorch height") +
    xlab("Trait community weighted mean") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# stand alone scatterplots of scorh height vs traits
sla_scorch <- scorch_scatter %>%
  filter(trait=="Spec leaf area (mm2/mg)")
sla_scorch_plot <- ggplot(sla_scorch, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between specific leaf area and scorch height") +
    xlab("Specific leaf area (mm2/mg)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ll_scorch <- scorch_scatter %>%
  filter(trait=="Leaf length (cm)")
ll_scorch_plot <- ggplot(ll_scorch, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf length and scorch height") +
    xlab("Leaf length (cm)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lw_scorch <- scorch_scatter %>%
  filter(trait=="Leaf width (cm)")
lw_scorch_plot <- ggplot(lw_scorch, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf width and scorch height") +
    xlab("Leaf width (cm)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

height_scorch <- scorch_scatter %>%
  filter(trait=="Plant height (m)")
height_scorch_plot <- ggplot(height_scorch, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between plant height and scorch height") +
    xlab("Plant height (m)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lc_scorch <- scorch_scatter %>%
  filter(trait=="Leaf curl height (mm)")
lc_scorch_plot <- ggplot(lc_scorch, aes(x=cwm, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf curl height and scorch height") +
    xlab("Leaf curl height (mm)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# calculate mean crown scorch % per plot
mean_csp <- postfire_whole %>%
  group_by(plot_id) %>%
  summarise(mean_csp = mean(cr_sc_pct))

# create data frame for scorch scatterplots
bm_csp_scatter <- bm_cwm_arrange %>%
  mutate(csp = case_match(
    plot_id,
    "24" ~ "0.0000000",
    "25" ~ "0.8750000",
    "26" ~ "0.000000",
    "27" ~ "0.1666667",
    "33" ~ "17.5000000",
    "49" ~ "8.1000000",
    "50" ~ "45.0000000",
    "51" ~ "0.6250000",
    "52" ~ "6.8333333",
    "53" ~ "27.4000000",
    "48" ~ "25.0000000")) %>%
  mutate(csp=as.numeric(csp)) %>%
  mutate(location=rep("Bluff Mesa", 50))

lm_csp_scatter <- laguna_cwm_arrange %>%
  mutate(csp = case_match(
    plot_id,
    "128" ~ "28.1250000",
    "129" ~ "0.0000000",
    "130" ~ "18.3333333",
    "131" ~ "NA",
    "132" ~ "81.6666667",
    "133" ~ "31.0000000",
    "134" ~ "29.0000000",
    "135" ~ "0.8333333",
    "137" ~ "14.7142857",
    "138" ~ "61.0000000",
    "139" ~ "7.5000000",
    "140" ~ "8.2142857",
    "141" ~ "26.0625000",
    "142" ~ "27.3750000",
    "143" ~ "29.5000000",
    "144" ~ "1.6666667",
    "145" ~ "8.3333333",
    "170" ~ "22.0000000",
    "171" ~ "26.0000000",
    "172" ~ "4.5555556",
    "173" ~ "40.9333333",
    "175" ~ "6.8750000",
    "176" ~ "1.7142857",
    "177" ~ "10.0000000",
    "179" ~ "1.6666667",
    "180" ~ "2.9411765",
    "181" ~ "8.9473684",
    "195" ~ "0.8000000",
    "197" ~ "0.0000000",
    "198" ~ "55.0000000",
    "199" ~ "60.8333333",
    "200" ~ "10.5454545",
    "196" ~ "0.0000000"
  )) %>%
  mutate(csp=na_if(csp, "NA")) %>%
  na.omit() %>%
  mutate(csp=as.numeric(csp)) %>%
  mutate(location=rep("Laguna Mountain", 155))

csp_scatter <- rbind(lm_csp_scatter, bm_csp_scatter)

# faceted scatterplots of crown scorch % vs traits
traits_csp_plot <- ggplot(csp_scatter, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    facet_wrap(~trait, scales = c("free")) +
    ggtitle("Correlations between functional traits and crown scorch") +
    xlab("Trait community weighted mean") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# stand alone scatterplots of crown scorch % vs traits
sla_csp <- csp_scatter %>%
  filter(trait=="Spec leaf area (mm2/mg)")
sla_csp_plot <- ggplot(sla_csp, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between specific leaf area and crown scorch") +
    xlab("Specific leaf area (mm2/mg)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ll_csp <- csp_scatter %>%
  filter(trait=="Leaf length (cm)")
ll_csp_plot <- ggplot(ll_csp, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf length and crown scorch") +
    xlab("Leaf length (cm)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lw_csp <- csp_scatter %>%
  filter(trait=="Leaf width (cm)")
lw_csp_plot <- ggplot(lw_csp, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf width and crown scorch") +
    xlab("Leaf width (cm)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

height_csp <- csp_scatter %>%
  filter(trait=="Plant height (m)")
height_csp_plot <- ggplot(height_csp, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between plant height and crown scorch") +
    xlab("Plant height (m)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lc_csp <- csp_scatter %>%
  filter(trait=="Leaf curl height (mm)")
lc_csp_plot <- ggplot(lc_csp, aes(x=cwm, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf curl height and crown scorch") +
    xlab("Leaf curl height (mm)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# display plots
traits_char_plot
traits_scorch_plot
traits_csp_plot

sla_char_plot
ll_char_plot
lw_char_plot
height_char_plot
lc_char_plot
sla_scorch_plot
ll_scorch_plot
lw_scorch_plot
height_scorch_plot
lc_scorch_plot
sla_csp_plot
ll_csp_plot
lw_csp_plot
height_csp_plot
lc_csp_plot
```

## fire severity vs. fuels scatterplots
```{r}
# filter fuel data to only include 1hr fuels
one_hr <- fuel_class %>%
  filter(fuel_class=="one_hr") %>%
  slice(-c(4, 9)) %>%
  mutate(char_ht = mean_char_ht$mean_char_ht) %>%
  mutate(scorch_ht = mean_scorch_ht$mean_scorch_ht) %>%
  mutate(csp = mean_csp$mean_csp) %>%
  slice(-39)

# filter fuel data to only include 10hr fuels
ten_hr <- fuel_class %>%
  filter(fuel_class=="ten_hr") %>%
  slice(-c(4, 9)) %>%
  mutate(char_ht = mean_char_ht$mean_char_ht) %>%
  mutate(scorch_ht = mean_scorch_ht$mean_scorch_ht) %>%
  mutate(csp = mean_csp$mean_csp) %>%
  slice(-39)

# filter fuel data to only include 100hr fuels
hun_hr <- fuel_class %>%
  filter(fuel_class=="hun_hr") %>%
  slice(-c(4, 9)) %>%
  mutate(char_ht = mean_char_ht$mean_char_ht) %>%
  mutate(scorch_ht = mean_scorch_ht$mean_scorch_ht) %>%
  mutate(csp = mean_csp$mean_csp) %>%
  slice(-39)

# scatterplots of char height vs fuels
one_char_plot <- ggplot(one_hr, aes(x=value, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 1-hour fuel loading and char height") +
    xlab("1-hour fuels (tons/acre)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ten_char_plot <- ggplot(ten_hr, aes(x=value, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 10-hour fuel loading and char height") +
    xlab("10-hour fuels (tons/acre)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

hun_char_plot <- ggplot(hun_hr, aes(x=value, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 100-hour fuel loading and char height") +
    xlab("100-hour fuels (tons/acre)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# combine duff & litter values together per plot
duff_litter_total <- duff_litter %>%
  group_by(plot_id) %>%
  summarise(duff_litter = sum(value)) %>%
  slice(-c(4,9)) %>%
  mutate(location = c(rep("Laguna Mountain", 32), rep("Bluff Mesa", 11))) %>%
  mutate(char_ht = mean_char_ht$mean_char_ht) %>%
  mutate(scorch_ht = mean_scorch_ht$mean_scorch_ht) %>%
  mutate(csp = mean_csp$mean_csp) 

# scatterplot of duff & litter vs. char height
dl_char_plot <- ggplot(duff_litter_total, aes(x=duff_litter, y=char_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between duff & litter loading and char height") +
    xlab("Duff & litter (tons/acre)") +
    ylab("Mean char height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplots of scorch height vs fuels
one_scorch_plot <- ggplot(one_hr, aes(x=value, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 1-hour fuel loading and scorch height") +
    xlab("1-hour fuels (tons/acre)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ten_scorch_plot <- ggplot(ten_hr, aes(x=value, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 10-hour fuel loading and scorch height") +
    xlab("10-hour fuels (tons/acre)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

hun_scorch_plot <- ggplot(hun_hr, aes(x=value, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 100-hour fuel loading and scorch height") +
    xlab("100-hour fuels (tons/acre)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplot of duff & litter vs. scorch height
dl_scorch_plot <- ggplot(duff_litter_total, aes(x=duff_litter, y=scorch_ht, color=location)) + 
    geom_point() +
    ggtitle("Correlation between duff & litter loading and scorch height") +
    xlab("Duff & litter (tons/acre)") +
    ylab("Mean scorch height per plot (m)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplots of crown scorch vs fuels
one_csp_plot <- ggplot(one_hr, aes(x=value, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 1-hour fuel loading and crown scorch") +
    xlab("1-hour fuels (tons/acre)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ten_csp_plot <- ggplot(ten_hr, aes(x=value, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 10-hour fuel loading and crown scorch") +
    xlab("10-hour fuels (tons/acre)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

hun_csp_plot <- ggplot(hun_hr, aes(x=value, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between 100-hour fuel loading and crown scorch") +
    xlab("100-hour fuels (tons/acre)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplot of duff & litter vs. crown scorch 
dl_csp_plot <- ggplot(duff_litter_total, aes(x=duff_litter, y=csp, color=location)) + 
    geom_point() +
    ggtitle("Correlation between duff & litter loading and crown scorch") +
    xlab("Duff & litter (tons/acre)") +
    ylab("Mean crown scorch per plot (%)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# print plots
one_char_plot
ten_char_plot
hun_char_plot
dl_char_plot
one_scorch_plot
ten_scorch_plot
hun_scorch_plot
dl_scorch_plot
one_csp_plot
ten_csp_plot
hun_csp_plot
dl_csp_plot
```

## litter density vs. leaf trait scatterplots
```{r}
# calculate litter density per plot (tons/m3)
density_whole <- fuels_whole %>%
  select(macroplot, duff, litter, tot_dep) %>%
  mutate(tot_mass = duff + litter) %>%
  mutate(tot_dep_m = tot_dep/100) %>%
  mutate(volume_m3 = tot_dep_m*405) %>%
  mutate(mass_tons = (tot_mass/4046.86)*405) %>%
  mutate(density = mass_tons/volume_m3) 

density <- density_whole %>%
  slice(-c(9,18)) %>%
  mutate(location = c(rep("Laguna Mountain", 32), rep("Bluff Mesa", 11)))

# create dataframe for all cwm values
cwm_all <- rbind(laguna_cwm, bluffmesa_cwm) %>%
  distinct(sla_cwm, ll_cwm, width_cwm, height_cwm, curl_cwm)

# add cwms to density dataframe
density <- density %>%
  mutate(sla = cwm_all$sla_cwm) %>%
  mutate(ll = cwm_all$ll_cwm) %>%
  mutate(lw = cwm_all$width_cwm) %>%
  mutate(height = cwm_all$height_cwm) %>%
  mutate(lc = cwm_all$curl_cwm)

# scatterplot: traits vs. litter density
sla_dens_plot <- ggplot(density, aes(x=sla, y=density, color=location)) + 
    geom_point() +
    ggtitle("Correlation between specific leaf area and litter density") +
    xlab("Specific leaf area (mm2/mg)") +
    ylab("Litter density (tons/m3)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

ll_dens_plot <- ggplot(density, aes(x=ll, y=density, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf length and litter density") +
    xlab("Leaf length (cm)") +
    ylab("Litter density (tons/m3)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lw_dens_plot <- ggplot(density, aes(x=lw, y=density, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf width and litter density") +
    xlab("Leaf width (cm)") +
    ylab("Litter density (tons/m3)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

height_dens_plot <- ggplot(density, aes(x=height, y=density, color=location)) + 
    geom_point() +
    ggtitle("Correlation between plant height and litter density") +
    xlab("Plant height (m)") +
    ylab("Litter density (tons/m3)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

lc_dens_plot <- ggplot(density, aes(x=lc, y=density, color=location)) + 
    geom_point() +
    ggtitle("Correlation between leaf curl height and litter density") +
    xlab("Leaf curl height (mm)") +
    ylab("Litter density (tons/m3)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# print plots
sla_dens_plot
ll_dens_plot
lw_dens_plot
height_dens_plot
lc_dens_plot
```

## fuel consumption vs. leaf trait scatterplots   
```{r}
# add cwms to consumption dataframe
consumption <- consumption %>%
  mutate(sla = cwm_all$sla_cwm) %>%
  mutate(ll = cwm_all$ll_cwm) %>%
  mutate(lw = cwm_all$width_cwm) %>%
  mutate(height = cwm_all$height_cwm) %>%
  mutate(lc = cwm_all$curl_cwm) %>%
  slice(-35)

# scatterplot of sla vs. duff/litter consumed
sla_cons_plot <- ggplot(consumption, aes(x=sla, y=duff_litter_diff, color=location)) +
    geom_point() +
    ggtitle("Correlation between specific leaf area and duff/litter consumed") +
    xlab("Specific leaf area (mm2/mg)") +
    ylab("Duff/litter consumed (tons/area)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

consumption_laguna <- consumption %>%
  filter(!location == "Bluff Mesa")

# scatterplot of leaf length vs. duff/litter consumed
ll_cons_plot <- ggplot(consumption, aes(x=ll, y=duff_litter_diff, color = location)) +
    geom_point() +
    ggtitle("Correlation between leaf length and duff/litter consumed") +
    xlab("Leaf length (cm)") +
    ylab("Duff/litter consumed (tons/area)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplot of sla vs. duff/litter depth consumed
sla_cons_plot2 <- ggplot(consumption, aes(x=sla, y=dep_diff, color=location)) +
    geom_point() +
    ggtitle("Correlation between specific leaf area and duff/litter depth consumed") +
    xlab("Specific leaf area (mg/mm2)") +
    ylab("Duff/litter depth consumed (cm)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplot of leaf length vs. duff/litter depth consumed
ll_cons_plot2 <- ggplot(consumption, aes(x=ll, y=dep_diff, color=location)) +
    geom_point() +
    ggtitle("Correlation between leaf length and duff/litter depth consumed") +
    xlab("Leaf length (cm)") +
    ylab("Duff/litter depth consumed (cm)") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# print plots
sla_cons_plot
ll_cons_plot 
sla_cons_plot2
ll_cons_plot2 
```

# statistical analyses
## linear regressions: leaf traits vs. fire severity
```{r}
# SLA v. char height
lr_sla_char = lm(char_ht~cwm, data = sla_char) # create the linear regression
summary(lr_sla_char) # review the results --> SIGNIFICANT

# leaf length v. char height
lr_ll_char = lm(char_ht~cwm, data = ll_char) # create the linear regression
summary(lr_ll_char) # review the results --> SIGNIFICANT

# leaf width v. char height
lr_lw_char = lm(char_ht~cwm, data = lw_char) # create the linear regression
summary(lr_lw_char) # review the results --> SIGNIFICANT

# plant height v. char height
lr_height_char = lm(char_ht~cwm, data = height_char) # create the linear regression
summary(lr_height_char) # review the results --> SIGNIFICANT

# curl height v. char height
lr_lc_char = lm(char_ht~cwm, data = lc_char) # create the linear regression
summary(lr_lc_char) # review the results --> SIGNIFICANT

# SLA v. scorch height
lr_sla_scorch = lm(scorch_ht~cwm, data = sla_scorch) # create the linear regression
summary(lr_sla_scorch) # review the results --> SIGNIFICANT

# leaf length v. scorch height
lr_ll_scorch = lm(scorch_ht~cwm, data = ll_scorch) # create the linear regression
summary(lr_ll_scorch) # review the results --> SIGNIFICANT

# leaf width v. scorch height
lr_lw_scorch = lm(scorch_ht~cwm, data = lw_scorch) # create the linear regression
summary(lr_lw_scorch) # review the results --> SIGNIFICANT

# plant height v. scorch height
lr_height_scorch = lm(scorch_ht~cwm, data = height_scorch) # create the linear regression
summary(lr_height_scorch) # review the results --> SIGNIFICANT

# leaf curl height v. scorch height
lr_lc_scorch = lm(scorch_ht~cwm, data = lc_scorch) # create the linear regression
summary(lr_lc_scorch) # review the results --> SIGNIFICANT

# SLA v. crown scorch percent
lr_sla_csp = lm(csp~cwm, data = sla_csp) # create the linear regression
summary(lr_sla_csp) # review the results --> not significant

# leaf length v. crown scorch percent
lr_ll_csp = lm(csp~cwm, data = ll_csp) # create the linear regression
summary(lr_ll_csp) # review the results --> not significant

# leaf width v. crown scorch percent
lr_lw_csp = lm(csp~cwm, data = lw_csp) # create the linear regression
summary(lr_lw_csp) # review the results --> not significant

# plant height v. crown scorch percent
lr_height_csp = lm(csp~cwm, data = height_csp) # create the linear regression
summary(lr_height_csp) # review the results --> not significant

# leaf curl height v. crown scorch percent
lr_lc_csp = lm(csp~cwm, data = lc_csp) # create the linear regression
summary(lr_lc_csp) # review the results --> not significant
```

## linear regressions: fuels vs. fire severity
```{r}
# 1 hr v. char height
lr_one_char = lm(char_ht~value, data = one_hr) # create the linear regression
summary(lr_one_char) # review the results --> not significant

# 10 hr v. char height
lr_ten_char = lm(char_ht~value, data = ten_hr) # create the linear regression
summary(lr_ten_char) # review the results --> not significant

# 100 hr v. char height
lr_hun_char = lm(char_ht~value, data = hun_hr) # create the linear regression
summary(lr_hun_char) # review the results --> not significant

# duff/litter v. char height
lr_dl_char = lm(char_ht~duff_litter, data = duff_litter_total) # create the linear regression
summary(lr_dl_char) # review the results --> not significant

# 1 hr v. scorch height
lr_one_scorch = lm(scorch_ht~value, data = one_hr) # create the linear regression
summary(lr_one_scorch) # review the results --> not significant

# 10 hr v. scorch height
lr_ten_scorch = lm(scorch_ht~value, data = ten_hr) # create the linear regression
summary(lr_ten_scorch) # review the results --> not significant

# 100 hr v. scorch height
lr_hun_scorch = lm(scorch_ht~value, data = hun_hr) # create the linear regression
summary(lr_hun_scorch) # review the results --> not significant

# duff/litter v. scorch height
lr_dl_scorch = lm(scorch_ht~duff_litter, data = duff_litter_total) # create the linear regression
summary(lr_dl_scorch) # review the results --> not significant

# 1 hr v. crown scorch
lr_one_csp = lm(csp~value, data = one_hr) # create the linear regression
summary(lr_one_csp) # review the results --> not significant

# 10 hr v. crown scorch 
lr_ten_csp = lm(csp~value, data = ten_hr) # create the linear regression
summary(lr_ten_csp) # review the results --> not significant

# 100 hr v. crown scorch 
lr_hun_csp = lm(csp~value, data = hun_hr) # create the linear regression
summary(lr_hun_csp) # review the results --> not significant

# duff/litter v. crown scorch 
lr_dl_csp = lm(csp~duff_litter, data = duff_litter_total) # create the linear regression
summary(lr_dl_csp) # review the results --> not significant
```

## linear regressions: leaf traits vs. litter density
```{r}
# SLA v. density
lr_sla_dens = lm(density~sla, data = density) # create the linear regression
summary(lr_sla_dens) # review the results --> not significant

# leaf length v. density
lr_ll_dens = lm(density~ll, data = density) # create the linear regression
summary(lr_ll_dens) # review the results --> not significant

# leaf width v. density
lr_lw_dens = lm(density~lw, data = density) # create the linear regression
summary(lr_lw_dens) # review the results --> not significant

# height v. density
lr_height_dens = lm(density~height, data = density) # create the linear regression
summary(lr_height_dens) # review the results --> not significant

# curl v. density
lr_lc_dens = lm(density~lc, data = density) # create the linear regression
summary(lr_lc_dens) # review the results --> not significant
```

## linear regressions: leaf traits vs. fuel consumption
## multiple regression: leaf traits vs. fire severity
```{r}
# create dataframe 
char_ht <- sla_char$char_ht
sla <- sla_char$cwm
ll <- ll_char$cwm
width <- lw_char$cwm
height <- height_char$cwm
curl <- lc_char$cwm

char_mult_data <- data.frame(char_ht, sla, ll, width, height, curl)
cor(char_mult_data)

# char height: sla, ll, & width
char_mult1 <- lm(char_ht ~ sla + ll + width, data = char_mult_data) # multiple regression model
summary(char_mult1) # display results of mult. regression --> not significant

# char height: sla, ll, & curl
char_mult3 <- lm(char_ht ~ sla + ll + curl, data = char_mult_data) # multiple regression model
summary(char_mult3) # display results of mult. regression --> not significant

# create dataframe 
scorch_ht <- sla_scorch$scorch_ht
sla <- sla_scorch$cwm
ll <- ll_scorch$cwm
width <- lw_scorch$cwm
height <- height_scorch$cwm
curl <- lc_scorch$cwm

scorch_mult_data <- data.frame(scorch_ht, sla, ll, width, height, curl)

# scorch height: sla, ll, & width
scorch_mult1 <- lm(scorch_ht ~ sla + ll + width, data = scorch_mult_data) # multiple regression model
summary(scorch_mult1) # display results of mult. regression --> SIGNIFICANT?

# scorch height: sla, ll, & curl
scorch_mult3 <- lm(scorch_ht ~ sla + ll + curl, data = scorch_mult_data) # multiple regression model
summary(scorch_mult3) # display results of mult. regression --> SIGNIFICANT?

# create dataframe 
csp <- sla_csp$csp
sla <- sla_csp$cwm
ll <- ll_csp$cwm
width <- lw_csp$cwm
height <- height_csp$cwm
curl <- lc_csp$cwm

csp_mult_data <- data.frame(csp, sla, ll, width, height, curl)

# crown scorch %: sla, ll, & width
csp_mult1 <- lm(csp ~ sla + ll + width, data = csp_mult_data) # multiple regression model
summary(csp_mult1) # display results of mult. regression --> not significant

# crown scorch %: sla, ll, & curl
csp_mult3 <- lm(csp ~ sla + ll + curl, data = csp_mult_data) # multiple regression model
summary(csp_mult3) # display results of mult. regression --> not significant
```

## multiple regression: leaf traits vs. fuel consumption
```{r}
cor_consumption <- consumption %>%
  select(sla, ll, lw, lc)

cor(cor_consumption)

# 1hr ~ SLA, ll
onehr_mult1 <- lm(one_hr_diff ~ sla + ll, data = consumption) # multiple regression model
summary(onehr_mult1) # display results of mult. regression --> not significant

# 1hr ~ width, ll
onehr_mult2 <- lm(one_hr_diff ~ lw + ll, data = consumption) # multiple regression model
summary(onehr_mult2) # display results of mult. regression --> not significant

# 1hr ~ curl, ll
onehr_mult3 <- lm(one_hr_diff ~ lc + ll, data = consumption) # multiple regression model
summary(onehr_mult3) # display results of mult. regression --> not significant

# 10hr ~ SLA, ll, width
tenhr_mult1 <- lm(ten_hr_diff ~ sla + ll + lw, data = consumption) # multiple regression model
summary(tenhr_mult1) # display results of mult. regression --> not significant

# 100hr ~ SLA, ll, width
hunhr_mult1 <- lm(hun_hr_diff ~ sla + ll + lw, data = consumption) # multiple regression model
summary(hunhr_mult1) # display results of mult. regression --> not significant

# duff & litter ~ SLA, ll
dl_mult1 <- lm(duff_litter_diff ~ sla + ll, data = consumption) # multiple regression model
summary(dl_mult1) # display results of mult. regression --> SIGNIFICANT?

# duff & litter ~ width, ll
dl_mult2 <- lm(duff_litter_diff ~ lw + ll, data = consumption) # multiple regression model
summary(dl_mult2) # display results of mult. regression --> SIGNIFICANT?

# duff & litter ~ curl, ll
dl_mult3 <- lm(duff_litter_diff ~ lc + ll, data = consumption) # multiple regression model
summary(dl_mult3) # display results of mult. regression --> SIGNIFICANT?

# duff & litter dep ~ sla, ll
dep_mult1 <- lm(dep_diff ~ sla + ll, data = consumption) # multiple regression model
summary(dep_mult1) # display results of mult. regression --> SIGNIFICANT?

# duff & litter dep ~ lw, ll
dep_mult2 <- lm(dep_diff ~ lw + ll, data = consumption) # multiple regression model
summary(dep_mult2) # display results of mult. regression --> SIGNIFICANT?

# duff & litter dep ~ curl, ll
dep_mult3 <- lm(dep_diff ~ lc + ll, data = consumption) # multiple regression model
summary(dep_mult3) # display results of mult. regression --> SIGNIFICANT?
```


## PCA
### PCA: leaf traits (both locations)
```{r}
# create data frame of just leaf traits
site <- c(rep("Laguna Mountain", 32), rep("Bluff Mesa", 10))

trait_all <- rbind(l_trait_clean, b_trait_clean) %>% 
  na.omit() %>%
  ungroup() %>%
  mutate(location = site) %>%
  mutate(plot_id = as.numeric(plot_id)) %>%
  slice(-c(4, 37)) %>%
  arrange(plot_id)

pca_trait_data <- trait_all %>%
  select(-c(plot_id, location, height_cwm)) # select only the continuous variables being analyzed

# conduct PCA, stats::prcomp 
pca_traits <- prcomp(pca_trait_data, scale = TRUE)

# show PCA results -> larger numbers = more variance explained by principal component; more explanatory power
summary(pca_traits)

# show scree plot (visualize how eigen values decrease with # of ordination axes)
screeplot(pca_traits, type="lines")

# calculate structure coefficients
cor(pca_trait_data, pca_traits$x)

# do the math, same results as above
loadings <- pca_traits$rotation
sdev <- pca_traits$sdev
struct.function <- function(loadings, sdev){
  loadings*sdev
}

s.corr <- t(apply(loadings, 1, struct.function, sdev))

head(s.corr[, 1:4])

# % of the variable's variance represented by that component
s.corr2 <- s.corr^2
s.corr2

# calculate communality: proportion of variance explained after PCs have been retained
# if you retain all PCs, communality will equal 1...
s.corr.df <- as.data.frame(s.corr) %>%
  select(PC1:PC2)

strct.corr2 <- s.corr.df^2

apply(strct.corr2, 1, sum) # what does this do? why are my values showing 1?

# view pca
biplot_traits <- autoplot(pca_traits, data = trait_all,
                          colour = "location",
                           loadings = TRUE, loadings.colour = "lightblue",
                           loadings.label = TRUE, loadings.label.colour = "black") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(size = 10, angle = 20))

biplot_traits
```

### PCA: leaf traits (laguna)
```{r}
# create the data frame & only include the values to be analyzed in pca
pca_laguna_data <- trait_all %>%
  filter(location == "Laguna Mountain") %>%
  select(-c(plot_id, location))

# conduct PCA, stats::prcomp 
pca_laguna <- prcomp(pca_laguna_data, scale=TRUE)

# show PCA results -> larger numbers = more variance explained by principal component; more explanatory power
summary(pca_laguna)

# show scree plot (visualize how eigen values decrease with # of ordination axes)
screeplot(pca_laguna, type="lines")

# calculate structure coefficients
cor(pca_laguna_data, pca_laguna$x)

# do the math, same results as above
loadings <- pca_laguna$rotation
sdev <- pca_laguna$sdev
struct.function <- function(loadings, sdev){
  loadings*sdev
}

s.corr.l <- t(apply(loadings, 1, struct.function, sdev))

head(s.corr.l[, 1:4])

# % of the variable's variance represented by that component
s.corr.l2 <- s.corr.l^2
s.corr.l2

# calculate communality: proportion of variance explained after PCs have been retained
# if you retain all PCs, communality will equal 1...
s.corr.l.df <- as.data.frame(s.corr.l) %>%
  select(PC1:PC2)

strct.corr.l2 <- s.corr.l.df^2

apply(strct.corr.l2, 1, sum) # what does this do? why are my values showing 1?

# view pca
biplot_laguna <- autoplot(pca_laguna, data = pca_laguna_data,
                           loadings = TRUE, loadings.colour = "lightblue",
                           loadings.label = TRUE, loadings.label.colour = "black") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(size = 10, angle = 20))

biplot_laguna
```

### PCA; leaf traits (bluff mesa)
```{r}
# create the data frame & only include the values to be analyzed in pca
pca_bluff_data <- trait_all %>%
  filter(location == "Bluff Mesa") %>%
  select(-c(plot_id, location, curl_cwm))

# conduct PCA, stats::prcomp 
pca_bluff <- prcomp(pca_bluff_data, scale=TRUE)

# show PCA results -> larger numbers = more variance explained by principal component; more explanatory power
summary(pca_bluff)

# show scree plot (visualize how eigen values decrease with # of ordination axes)
screeplot(pca_bluff, type="lines")

# calculate structure coefficients
cor(pca_bluff_data, pca_bluff$x)

# do the math, same results as above
loadings <- pca_bluff$rotation
sdev <- pca_bluff$sdev
struct.function <- function(loadings, sdev){
  loadings*sdev
}

s.corr.b <- t(apply(loadings, 1, struct.function, sdev))

head(s.corr.b[, 1:4])

# % of the variable's variance represented by that component
s.corr.b2 <- s.corr.b^2
s.corr.b2

# calculate communality: proportion of variance explained after PCs have been retained
# if you retain all PCs, communality will equal 1...
s.corr.b.df <- as.data.frame(s.corr.b) %>%
  select(PC1:PC2)

strct.corr.b2 <- s.corr.b.df^2

apply(strct.corr.b2, 1, sum) # what does this do? why are my values showing 1?

# view pca
biplot_bluff <- autoplot(pca_bluff, data = pca_bluff_data,
                           loadings = TRUE, loadings.colour = "lightblue",
                           loadings.label = TRUE, loadings.label.colour = "black") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(size = 10, angle = 20))

biplot_bluff
```

### PCA: fire severity (both locations)
```{r}
# create data frame of just fire sev
fire_all <- postfire_whole %>%
  select(-c(location, species, category)) %>%
  group_by(plot_id) %>%
  summarise_all(mean) ## LEFT OFF HERE: ADD FUEL CONSUM DATA USING RBIND CONSUMPTION + FIRE_ALL

pca_fire_data_all <- merge(fire_all, consumption, by = "plot_id") %>%
  slice(-37) %>%
  arrange(plot_id)

pca_fire_data <- pca_fire_data_all %>%
  select(-c(plot_id, location, sla, ll, lw, height, lc))

# conduct PCA, stats::prcomp 
pca_fire <- prcomp(pca_fire_data, scale=TRUE)

# show PCA results -> larger numbers = more variance explained by principal component; more explanatory power
summary(pca_fire)

# show scree plot (visualize how eigen values decrease with # of ordination axes)
screeplot(pca_fire, type="lines")

# calculate structure coefficients
cor(pca_fire_data, pca_fire$x)

# do the math, same results as above
loadings <- pca_fire$rotation
sdev <- pca_fire$sdev
struct.function <- function(loadings, sdev){
  loadings*sdev
}

s.corr <- t(apply(loadings, 1, struct.function, sdev))

head(s.corr[, 1:4])

# % of the variable's variance represented by that component
s.corr2 <- s.corr^2
s.corr2

# calculate communality: proportion of variance explained after PCs have been retained
# if you retain all PCs, communality will equal 1...
s.corr.df <- as.data.frame(s.corr) %>%
  select(PC1:PC2)

strct.corr2 <- s.corr.df^2

apply(strct.corr2, 1, sum) # what does this do? why are my values showing 1?

# view pca
biplot_fire <- autoplot(pca_fire, data = pca_fire_data_all,
                          colour = "location",
                           loadings = TRUE, loadings.colour = "lightblue",
                           loadings.label = TRUE, loadings.label.colour = "black") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(size = 10, angle = 20))

biplot_fire
```

### PCA: fuel loading (both locations)
```{r}
# fuel: delete 131, 136, 145, 26
# create data frame of just fuel loading
pca_fuel_all <- fuels_whole %>%
  slice(-c(4, 9, 18, 37, 41))

# load in density data & fit to fuel data
density_pca <- density_whole %>%
  slice(-c(4, 9, 18, 37, 41))

pca_fuel_data <- merge(pca_fuel_all, density_pca, by = "macroplot") %>%
  arrange(macroplot) %>%
  select(c(one_hr, ten_hr, hun_hr, duff.x, litter.x, duff_dep, litt_dep, density))

# conduct PCA, stats::prcomp 
pca_fuel <- prcomp(pca_fuel_data, scale=TRUE)

# show PCA results -> larger numbers = more variance explained by principal component; more explanatory power
summary(pca_fuel)

# show scree plot (visualize how eigen values decrease with # of ordination axes)
screeplot(pca_fuel, type="lines")

# calculate structure coefficients
cor(pca_fuel_data, pca_fuel$x)

# do the math, same results as above
loadings <- pca_fuel$rotation
sdev <- pca_fuel$sdev
struct.function <- function(loadings, sdev){
  loadings*sdev
}

s.corr <- t(apply(loadings, 1, struct.function, sdev))

head(s.corr[, 1:4])

# % of the variable's variance represented by that component
s.corr2 <- s.corr^2
s.corr2

# calculate communality: proportion of variance explained after PCs have been retained
# if you retain all PCs, communality will equal 1...
s.corr.df <- as.data.frame(s.corr) %>%
  select(PC1:PC2)

strct.corr2 <- s.corr.df^2

apply(strct.corr2, 1, sum) 

# view pca
biplot_fuel <- autoplot(pca_fuel, data = pca_fuel_all,
                          colour = "location",
                           loadings = TRUE, loadings.colour = "gray",
                           loadings.label = TRUE, loadings.label.colour = "black") +
  scale_color_manual(values=wes_palette(n=2, name = "GrandBudapest1")) +
  theme_minimal() +
  theme(legend.position = "none",
        axis.title = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(size = 10, angle = 20))

biplot_fuel
```

### PCA scores
```{r}
traits_scores <- as.data.frame(pca_traits$x) # call scores for trait pca

fire_scores <- as.data.frame(pca_fire$x) # call scores for fire severity pca

fuel_scores <- as.data.frame(pca_fuel$x) # call scores for fuel loading pca
```

### PC regression
```{r}
# create vectors of PC1 scores for each PCA
traits <- traits_scores$PC1
fire <- fire_scores$PC1
fuel <- fuel_scores$PC1

# create data frame for PC regression with the PC1 scores vectors
pcr_data <- data.frame(traits, fire, fuel)

# traits v. fire sev
lr_traits_fire = lm(traits~fire, data = pcr_data) # create the linear regression
summary(lr_traits_fire) # review the results --> SIGNIFICANT

# fuels v. fire sev
lr_fuel_fire = lm(fuel~fire, data = pcr_data) # create the linear regression
summary(lr_fuel_fire) # review the results --> SIGNIFICANT 

# scatterplot of traits v. fire sev
traits_fire_plot <- ggplot(pcr_data, aes(x=traits, y=fire)) +
    geom_point() +
    ggtitle("Traits v. fire severity PCR") +
    xlab("Traits") +
    ylab("Fire severity") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

# scatterplot of fuels v. fire sev
fuel_fire_plot <- ggplot(pcr_data, aes(x=fuel, y=fire)) +
    geom_point() +
    ggtitle("Fuels v. fire PCR") +
    xlab("Fuels") +
    ylab("Fire severity") +
    geom_smooth(method=lm , color="darkblue", se=TRUE)

traits_fire_plot
fuel_fire_plot
```


